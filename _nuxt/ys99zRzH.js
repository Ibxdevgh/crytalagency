import{p as Zt,t as ve,B as Fs,m as vi,i as dt,a5 as Qa,a6 as fi,a7 as gi,a8 as Ja,g as wi,h as V,a9 as De,u as fe,R as tl,G as el,A as il,q as ol,aa as sl,C as at,S as nl,j as rl,F as al,d as ll,k as cl,O as hl,y as Ge,E as Ve,I as dl,J as He,K as ul,Q as xi,X as bi,W as Qt,L as vt,H as Jt,ab as pl,V as qt,M as Rs,T as Ye,s as Ei,w as _e,v as Ns,ac as Is,Y as yl,N as ml,x as Xe,ad as vl,ae as fl,z as gl,o as wl,_ as xl,a4 as bl,__tla as El}from"./Ct4PKcG_.js";import{G as Sl}from"./DNkUmkFf.js";import{a as et,j as Si,E as ge,H as _t,I as zi,M as O,a2 as ks,F as Ue,X as Lt,P as Ci,u as J,a9 as qs,V as zl,O as Ls,L as Xt,J as js,W as Cl}from"./CkGjpDBV.js";import{H as Al,__tla as Tl}from"./Dl96kq_x.js";import{__tla as Pl}from"./BsXJ030y.js";let Os,Ml=Promise.all([(()=>{try{return El}catch{}})(),(()=>{try{return Tl}catch{}})(),(()=>{try{return Pl}catch{}})()]).then(async()=>{var xt,Ai,we,Ti=function(){return xt||typeof window<"u"&&(xt=window.gsap)&&xt.registerPlugin&&xt},Pi=function(E){xt=Ti(),we=xt&&xt.parseEase("_CE"),we?(Ai=1,xt.parseEase("bounce").config=function(t){return typeof t=="object"?xe("",t):xe("bounce("+t+")",{strength:+t})}):E&&console.warn("Please gsap.registerPlugin(CustomEase, CustomBounce)")},Mi=function(E){var t=E.length,e=1/E[t-2],i=1e3,o;for(o=2;o<t;o+=2)E[o]=~~(E[o]*e*i)/i;E[t-2]=1},xe=function(E,t){Ai||Pi(1),t=t||{};{var e=.999,i=Math.min(e,t.strength||.7),o=i,s=(t.squash||0)/100,n=s,r=1/.03,l=.2,a=1,c=.1,u=[0,0,.07,0,.1,1,.1,1],d=[0,0,0,0,.1,0,.1,0],p,m,y,v,g,f,w;for(g=0;g<200&&(l*=o*((o+1)/2),a*=i*i,f=c+l,y=c+l*.49,v=1-a,p=c+a/r,m=y+(y-p)*.8,s&&(c+=s,p+=s,y+=s,m+=s,f+=s,w=s/n,d.push(c-s,0,c-s,w,c-s/2,w,c,w,c,0,c,0,c,w*-.6,c+(f-c)/6,0,f,0),u.push(c-s,1,c,1,c,1),s*=i*i),u.push(c,1,p,v,y,v,m,v,f,1,f,1),i*=.95,r=a/(f-m),c=f,!(v>e));g++);if(t.endAtStart&&t.endAtStart!=="false"){if(y=-.1,u.unshift(y,1,y,1,-.07,0),n)for(s=n*2.5,y-=s,u.unshift(y,1,y,1,y,1),d.splice(0,6),d.unshift(y,0,y,0,y,1,y+s/2,1,y+s,1,y+s,0,y+s,0,y+s,-.6,y+s+.033,0),g=0;g<d.length;g+=2)d[g]-=y;for(g=0;g<u.length;g+=2)u[g]-=y,u[g+1]=1-u[g+1]}return s&&(Mi(d),d[2]="C"+d[2],we(t.squashID||E+"-squash","M"+d.join(","))),Mi(u),u[2]="C"+u[2],we(E,"M"+u.join(","))}},$e=function(){function E(t,e){this.ease=xe(t,e)}return E.create=function(t,e){return xe(t,e)},E.register=function(t){xt=t,Pi()},E}();Ti()&&xt.registerPlugin($e),$e.version="3.12.5";var Ws=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,Ds=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/ig,Gs=Math.PI/180,be=Math.sin,Ee=Math.cos,te=Math.abs,ee=Math.sqrt,Vs=function(E){return typeof E=="number"},Bi=1e5,Rt=function(E){return Math.round(E*Bi)/Bi||0};function Hs(E,t,e,i,o,s,n){for(var r=E.length,l,a,c,u,d;--r>-1;)for(l=E[r],a=l.length,c=0;c<a;c+=2)u=l[c],d=l[c+1],l[c]=u*t+d*i+s,l[c+1]=u*e+d*o+n;return E._dirty=1,E}function Ys(E,t,e,i,o,s,n,r,l){if(!(E===r&&t===l)){e=te(e),i=te(i);var a=o%360*Gs,c=Ee(a),u=be(a),d=Math.PI,p=d*2,m=(E-r)/2,y=(t-l)/2,v=c*m+u*y,g=-u*m+c*y,f=v*v,w=g*g,S=f/(e*e)+w/(i*i);S>1&&(e=ee(S)*e,i=ee(S)*i);var P=e*e,B=i*i,k=(P*B-P*w-B*f)/(P*w+B*f);k<0&&(k=0);var T=(s===n?-1:1)*ee(k),x=T*(e*g/i),C=T*-(i*v/e),I=(E+r)/2,z=(t+l)/2,b=I+(c*x-u*C),R=z+(u*x+c*C),M=(v-x)/e,F=(g-C)/i,j=(-v-x)/e,_=(-g-C)/i,H=M*M+F*F,ot=(F<0?-1:1)*Math.acos(M/ee(H)),Z=(M*_-F*j<0?-1:1)*Math.acos((M*j+F*_)/ee(H*(j*j+_*_)));isNaN(Z)&&(Z=d),!n&&Z>0?Z-=p:n&&Z<0&&(Z+=p),ot%=p,Z%=p;var D=Math.ceil(te(Z)/(p/4)),nt=[],mt=Z/D,wt=4/3*be(mt/2)/(1+Ee(mt/2)),It=c*e,Wt=u*e,Ie=u*-i,Y=c*i,rt;for(rt=0;rt<D;rt++)o=ot+rt*mt,v=Ee(o),g=be(o),M=Ee(o+=mt),F=be(o),nt.push(v-wt*g,g+wt*v,M+wt*F,F-wt*M,M,F);for(rt=0;rt<nt.length;rt+=2)v=nt[rt],g=nt[rt+1],nt[rt]=v*It+g*Ie+b,nt[rt+1]=v*Wt+g*Y+R;return nt[rt-2]=r,nt[rt-1]=l,nt}}function _s(E){var t=(E+"").replace(Ds,function(x){var C=+x;return C<1e-4&&C>-1e-4?0:C}).match(Ws)||[],e=[],i=0,o=0,s=2/3,n=t.length,r=0,l="ERROR: malformed path: "+E,a,c,u,d,p,m,y,v,g,f,w,S,P,B,k,T=function(x,C,I,z){f=(I-x)/3,w=(z-C)/3,y.push(x+f,C+w,I-f,z-w,I,z)};if(!E||!isNaN(t[0])||isNaN(t[1]))return console.log(l),e;for(a=0;a<n;a++)if(P=p,isNaN(t[a])?(p=t[a].toUpperCase(),m=p!==t[a]):a--,u=+t[a+1],d=+t[a+2],m&&(u+=i,d+=o),a||(v=u,g=d),p==="M")y&&(y.length<8?e.length-=1:r+=y.length),i=v=u,o=g=d,y=[u,d],e.push(y),a+=2,p="L";else if(p==="C")y||(y=[0,0]),m||(i=o=0),y.push(u,d,i+t[a+3]*1,o+t[a+4]*1,i+=t[a+5]*1,o+=t[a+6]*1),a+=6;else if(p==="S")f=i,w=o,(P==="C"||P==="S")&&(f+=i-y[y.length-4],w+=o-y[y.length-3]),m||(i=o=0),y.push(f,w,u,d,i+=t[a+3]*1,o+=t[a+4]*1),a+=4;else if(p==="Q")f=i+(u-i)*s,w=o+(d-o)*s,m||(i=o=0),i+=t[a+3]*1,o+=t[a+4]*1,y.push(f,w,i+(u-i)*s,o+(d-o)*s,i,o),a+=4;else if(p==="T")f=i-y[y.length-4],w=o-y[y.length-3],y.push(i+f,o+w,u+(i+f*1.5-u)*s,d+(o+w*1.5-d)*s,i=u,o=d),a+=2;else if(p==="H")T(i,o,i=u,o),a+=1;else if(p==="V")T(i,o,i,o=u+(m?o-i:0)),a+=1;else if(p==="L"||p==="Z")p==="Z"&&(u=v,d=g,y.closed=!0),(p==="L"||te(i-u)>.5||te(o-d)>.5)&&(T(i,o,u,d),p==="L"&&(a+=2)),i=u,o=d;else if(p==="A"){if(B=t[a+4],k=t[a+5],f=t[a+6],w=t[a+7],c=7,B.length>1&&(B.length<3?(w=f,f=k,c--):(w=k,f=B.substr(2),c-=2),k=B.charAt(1),B=B.charAt(0)),S=Ys(i,o,+t[a+1],+t[a+2],+t[a+3],+B,+k,(m?i:0)+f*1,(m?o:0)+w*1),a+=c,S)for(c=0;c<S.length;c++)y.push(S[c]);i=y[y.length-2],o=y[y.length-1]}else console.log(l);return a=y.length,a<6?(e.pop(),a=0):y[0]===y[a-2]&&y[1]===y[a-1]&&(y.closed=!0),e.totalPoints=r+a,e}function Xs(E){Vs(E[0])&&(E=[E]);var t="",e=E.length,i,o,s,n;for(o=0;o<e;o++){for(n=E[o],t+="M"+Rt(n[0])+","+Rt(n[1])+" C",i=n.length,s=2;s<i;s++)t+=Rt(n[s++])+","+Rt(n[s++])+" "+Rt(n[s++])+","+Rt(n[s++])+" "+Rt(n[s++])+","+Rt(n[s])+" ";n.closed&&(t+="z")}return t}var lt,Fi,Ri=function(){return lt||typeof window<"u"&&(lt=window.gsap)&&lt.registerPlugin&&lt},Ni=function(){lt=Ri(),lt?(lt.registerEase("_CE",ze.create),Fi=1):console.warn("Please gsap.registerPlugin(CustomEase)")},Us=1e20,Se=function(E){return~~(E*1e3+(E<0?-.5:.5))/1e3},$s=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/gi,Ks=/[cLlsSaAhHvVtTqQ]/g,Zs=function(E){var t=E.length,e=Us,i;for(i=1;i<t;i+=6)+E[i]<e&&(e=+E[i]);return e},Qs=function(E,t,e){!e&&e!==0&&(e=Math.max(+E[E.length-1],+E[1]));var i=+E[0]*-1,o=-e,s=E.length,n=1/(+E[s-2]+i),r=-t||(Math.abs(+E[s-1]-+E[1])<.01*(+E[s-2]-+E[0])?Zs(E)+o:+E[s-1]+o),l;for(r?r=1/r:r=-n,l=0;l<s;l+=2)E[l]=(+E[l]+i)*n,E[l+1]=(+E[l+1]+o)*r},Js=function E(t,e,i,o,s,n,r,l,a,c,u){var d=(t+i)/2,p=(e+o)/2,m=(i+s)/2,y=(o+n)/2,v=(s+r)/2,g=(n+l)/2,f=(d+m)/2,w=(p+y)/2,S=(m+v)/2,P=(y+g)/2,B=(f+S)/2,k=(w+P)/2,T=r-t,x=l-e,C=Math.abs((i-r)*x-(o-l)*T),I=Math.abs((s-r)*x-(n-l)*T),z;return c||(c=[{x:t,y:e},{x:r,y:l}],u=1),c.splice(u||c.length-1,0,{x:B,y:k}),(C+I)*(C+I)>a*(T*T+x*x)&&(z=c.length,E(t,e,d,p,f,w,B,k,a,c,u),E(B,k,S,P,v,g,r,l,a,c,u+1+(c.length-z))),c},ze=function(){function E(e,i,o){Fi||Ni(),this.id=e,this.setData(i,o)}var t=E.prototype;return t.setData=function(e,i){i=i||{},e=e||"0,0,1,1";var o=e.match($s),s=1,n=[],r=[],l=i.precision||1,a=l<=1,c,u,d,p,m,y,v,g,f;if(this.data=e,(Ks.test(e)||~e.indexOf("M")&&e.indexOf("C")<0)&&(o=_s(e)[0]),c=o.length,c===4)o.unshift(0,0),o.push(1,1),c=8;else if((c-2)%6)throw"Invalid CustomEase";for((+o[0]!=0||+o[c-2]!=1)&&Qs(o,i.height,i.originY),this.segment=o,p=2;p<c;p+=6)u={x:+o[p-2],y:+o[p-1]},d={x:+o[p+4],y:+o[p+5]},n.push(u,d),Js(u.x,u.y,+o[p],+o[p+1],+o[p+2],+o[p+3],d.x,d.y,1/(l*2e5),n,n.length-1);for(c=n.length,p=0;p<c;p++)v=n[p],g=n[p-1]||v,(v.x>g.x||g.y!==v.y&&g.x===v.x||v===g)&&v.x<=1?(g.cx=v.x-g.x,g.cy=v.y-g.y,g.n=v,g.nx=v.x,a&&p>1&&Math.abs(g.cy/g.cx-n[p-2].cy/n[p-2].cx)>2&&(a=0),g.cx<s&&(g.cx?s=g.cx:(g.cx=.001,p===c-1&&(g.x-=.001,s=Math.min(s,.001),a=0)))):(n.splice(p--,1),c--);if(c=1/s+1|0,m=1/c,y=0,v=n[0],a){for(p=0;p<c;p++)f=p*m,v.nx<f&&(v=n[++y]),u=v.y+(f-v.x)/v.cx*v.cy,r[p]={x:f,cx:m,y:u,cy:0,nx:9},p&&(r[p-1].cy=u-r[p-1].y);r[c-1].cy=n[n.length-1].y-u}else{for(p=0;p<c;p++)v.nx<p*m&&(v=n[++y]),r[p]=v;y<n.length-1&&(r[p-1]=n[n.length-2])}return this.ease=function(w){var S=r[w*c|0]||r[c-1];return S.nx<w&&(S=S.n),S.y+(w-S.x)/S.cx*S.cy},this.ease.custom=this,this.id&&lt&&lt.registerEase(this.id,this.ease),this},t.getSVGData=function(e){return E.getSVGData(this,e)},E.create=function(e,i,o){return new E(e,i,o).ease},E.register=function(e){lt=e,Ni()},E.get=function(e){return lt.parseEase(e)},E.getSVGData=function(e,i){i=i||{};var o=i.width||100,s=i.height||100,n=i.x||0,r=(i.y||0)+s,l=lt.utils.toArray(i.path)[0],a,c,u,d,p,m,y,v,g,f;if(i.invert&&(s=-s,r=0),typeof e=="string"&&(e=lt.parseEase(e)),e.custom&&(e=e.custom),e instanceof E)a=Xs(Hs([e.segment],o,0,0,-s,n,r));else{for(a=[n,r],y=Math.max(5,(i.precision||1)*200),d=1/y,y+=2,v=5/y,g=Se(n+d*o),f=Se(r+e(d)*-s),c=(f-r)/(g-n),u=2;u<y;u++)p=Se(n+u*d*o),m=Se(r+e(u*d)*-s),(Math.abs((m-f)/(p-g)-c)>v||u===y-1)&&(a.push(g,f),c=(m-f)/(p-g)),g=p,f=m;a="M"+a.join(",")}return l&&l.setAttribute("d",a),a},E}();Ri()&&lt.registerPlugin(ze),ze.version="3.12.5";class ft{constructor(t){t===void 0&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}identity(){const t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}setZero(){const t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0}setTrace(t){const e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z}getTrace(t){t===void 0&&(t=new h);const e=this.elements;return t.x=e[0],t.y=e[4],t.z=e[8],t}vmult(t,e){e===void 0&&(e=new h);const i=this.elements,o=t.x,s=t.y,n=t.z;return e.x=i[0]*o+i[1]*s+i[2]*n,e.y=i[3]*o+i[4]*s+i[5]*n,e.z=i[6]*o+i[7]*s+i[8]*n,e}smult(t){for(let e=0;e<this.elements.length;e++)this.elements[e]*=t}mmult(t,e){e===void 0&&(e=new ft);const i=this.elements,o=t.elements,s=e.elements,n=i[0],r=i[1],l=i[2],a=i[3],c=i[4],u=i[5],d=i[6],p=i[7],m=i[8],y=o[0],v=o[1],g=o[2],f=o[3],w=o[4],S=o[5],P=o[6],B=o[7],k=o[8];return s[0]=n*y+r*f+l*P,s[1]=n*v+r*w+l*B,s[2]=n*g+r*S+l*k,s[3]=a*y+c*f+u*P,s[4]=a*v+c*w+u*B,s[5]=a*g+c*S+u*k,s[6]=d*y+p*f+m*P,s[7]=d*v+p*w+m*B,s[8]=d*g+p*S+m*k,e}scale(t,e){e===void 0&&(e=new ft);const i=this.elements,o=e.elements;for(let s=0;s!==3;s++)o[3*s+0]=t.x*i[3*s+0],o[3*s+1]=t.y*i[3*s+1],o[3*s+2]=t.z*i[3*s+2];return e}solve(t,e){e===void 0&&(e=new h);const i=3,o=4,s=[];let n,r;for(n=0;n<i*o;n++)s.push(0);for(n=0;n<3;n++)for(r=0;r<3;r++)s[n+o*r]=this.elements[n+3*r];s[3+4*0]=t.x,s[3+4*1]=t.y,s[3+4*2]=t.z;let l=3;const a=l;let c;const u=4;let d;do{if(n=a-l,s[n+o*n]===0){for(r=n+1;r<a;r++)if(s[n+o*r]!==0){c=u;do d=u-c,s[d+o*n]+=s[d+o*r];while(--c);break}}if(s[n+o*n]!==0)for(r=n+1;r<a;r++){const p=s[n+o*r]/s[n+o*n];c=u;do d=u-c,s[d+o*r]=d<=n?0:s[d+o*r]-s[d+o*n]*p;while(--c)}}while(--l);if(e.z=s[2*o+3]/s[2*o+2],e.y=(s[1*o+3]-s[1*o+2]*e.z)/s[1*o+1],e.x=(s[0*o+3]-s[0*o+2]*e.z-s[0*o+1]*e.y)/s[0*o+0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw`Could not solve equation! Got x=[${e.toString()}], b=[${t.toString()}], A=[${this.toString()}]`;return e}e(t,e,i){if(i===void 0)return this.elements[e+3*t];this.elements[e+3*t]=i}copy(t){for(let e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this}toString(){let t="";const e=",";for(let i=0;i<9;i++)t+=this.elements[i]+e;return t}reverse(t){t===void 0&&(t=new ft);const e=3,i=6,o=tn;let s,n;for(s=0;s<3;s++)for(n=0;n<3;n++)o[s+i*n]=this.elements[s+3*n];o[3+6*0]=1,o[3+6*1]=0,o[3+6*2]=0,o[4+6*0]=0,o[4+6*1]=1,o[4+6*2]=0,o[5+6*0]=0,o[5+6*1]=0,o[5+6*2]=1;let r=3;const l=r;let a;const c=i;let u;do{if(s=l-r,o[s+i*s]===0){for(n=s+1;n<l;n++)if(o[s+i*n]!==0){a=c;do u=c-a,o[u+i*s]+=o[u+i*n];while(--a);break}}if(o[s+i*s]!==0)for(n=s+1;n<l;n++){const d=o[s+i*n]/o[s+i*s];a=c;do u=c-a,o[u+i*n]=u<=s?0:o[u+i*n]-o[u+i*s]*d;while(--a)}}while(--r);s=2;do{n=s-1;do{const d=o[s+i*n]/o[s+i*s];a=i;do u=i-a,o[u+i*n]=o[u+i*n]-o[u+i*s]*d;while(--a)}while(n--)}while(--s);s=2;do{const d=1/o[s+i*s];a=i;do u=i-a,o[u+i*s]=o[u+i*s]*d;while(--a)}while(s--);s=2;do{n=2;do{if(u=o[e+n+i*s],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;t.e(s,n,u)}while(n--)}while(s--);return t}setRotationFromQuaternion(t){const e=t.x,i=t.y,o=t.z,s=t.w,n=e+e,r=i+i,l=o+o,a=e*n,c=e*r,u=e*l,d=i*r,p=i*l,m=o*l,y=s*n,v=s*r,g=s*l,f=this.elements;return f[3*0+0]=1-(d+m),f[3*0+1]=c-g,f[3*0+2]=u+v,f[3*1+0]=c+g,f[3*1+1]=1-(a+m),f[3*1+2]=p-y,f[3*2+0]=u-v,f[3*2+1]=p+y,f[3*2+2]=1-(a+d),this}transpose(t){t===void 0&&(t=new ft);const e=this.elements,i=t.elements;let o;return i[0]=e[0],i[4]=e[4],i[8]=e[8],o=e[1],i[1]=e[3],i[3]=o,o=e[2],i[2]=e[6],i[6]=o,o=e[5],i[5]=e[7],i[7]=o,t}}const tn=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class h{constructor(t,e,i){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this.x=t,this.y=e,this.z=i}cross(t,e){e===void 0&&(e=new h);const i=t.x,o=t.y,s=t.z,n=this.x,r=this.y,l=this.z;return e.x=r*s-l*o,e.y=l*i-n*s,e.z=n*o-r*i,e}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(t,e){if(e)e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z;else return new h(this.x+t.x,this.y+t.y,this.z+t.z)}vsub(t,e){if(e)e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z;else return new h(this.x-t.x,this.y-t.y,this.z-t.z)}crossmat(){return new ft([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const t=this.x,e=this.y,i=this.z,o=Math.sqrt(t*t+e*e+i*i);if(o>0){const s=1/o;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return o}unit(t){t===void 0&&(t=new h);const e=this.x,i=this.y,o=this.z;let s=Math.sqrt(e*e+i*i+o*o);return s>0?(s=1/s,t.x=e*s,t.y=i*s,t.z=o*s):(t.x=1,t.y=0,t.z=0),t}length(){const t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)}lengthSquared(){return this.dot(this)}distanceTo(t){const e=this.x,i=this.y,o=this.z,s=t.x,n=t.y,r=t.z;return Math.sqrt((s-e)*(s-e)+(n-i)*(n-i)+(r-o)*(r-o))}distanceSquared(t){const e=this.x,i=this.y,o=this.z,s=t.x,n=t.y,r=t.z;return(s-e)*(s-e)+(n-i)*(n-i)+(r-o)*(r-o)}scale(t,e){e===void 0&&(e=new h);const i=this.x,o=this.y,s=this.z;return e.x=t*i,e.y=t*o,e.z=t*s,e}vmul(t,e){return e===void 0&&(e=new h),e.x=t.x*this.x,e.y=t.y*this.y,e.z=t.z*this.z,e}addScaledVector(t,e,i){return i===void 0&&(i=new h),i.x=this.x+t*e.x,i.y=this.y+t*e.y,i.z=this.z+t*e.z,i}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(t){return t===void 0&&(t=new h),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}tangents(t,e){const i=this.length();if(i>0){const o=en,s=1/i;o.set(this.x*s,this.y*s,this.z*s);const n=on;Math.abs(o.x)<.9?(n.set(1,0,0),o.cross(n,t)):(n.set(0,1,0),o.cross(n,t)),o.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,e,i){const o=this.x,s=this.y,n=this.z;i.x=o+(t.x-o)*e,i.y=s+(t.y-s)*e,i.z=n+(t.z-n)*e}almostEquals(t,e){return e===void 0&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)}almostZero(t){return t===void 0&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)}isAntiparallelTo(t,e){return this.negate(Ii),Ii.almostEquals(t,e)}clone(){return new h(this.x,this.y,this.z)}}h.ZERO=new h(0,0,0),h.UNIT_X=new h(1,0,0),h.UNIT_Y=new h(0,1,0),h.UNIT_Z=new h(0,0,1);const en=new h,on=new h,Ii=new h;class ut{constructor(t){t===void 0&&(t={}),this.lowerBound=new h,this.upperBound=new h,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}setFromPoints(t,e,i,o){const s=this.lowerBound,n=this.upperBound,r=i;s.copy(t[0]),r&&r.vmult(s,s),n.copy(s);for(let l=1;l<t.length;l++){let a=t[l];r&&(r.vmult(a,ki),a=ki),a.x>n.x&&(n.x=a.x),a.x<s.x&&(s.x=a.x),a.y>n.y&&(n.y=a.y),a.y<s.y&&(s.y=a.y),a.z>n.z&&(n.z=a.z),a.z<s.z&&(s.z=a.z)}return e&&(e.vadd(s,s),e.vadd(n,n)),o&&(s.x-=o,s.y-=o,s.z-=o,n.x+=o,n.y+=o,n.z+=o),this}copy(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this}clone(){return new ut().copy(this)}extend(t){this.lowerBound.x=Math.min(this.lowerBound.x,t.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,t.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,t.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,t.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,t.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,t.upperBound.z)}overlaps(t){const e=this.lowerBound,i=this.upperBound,o=t.lowerBound,s=t.upperBound,n=o.x<=i.x&&i.x<=s.x||e.x<=s.x&&s.x<=i.x,r=o.y<=i.y&&i.y<=s.y||e.y<=s.y&&s.y<=i.y,l=o.z<=i.z&&i.z<=s.z||e.z<=s.z&&s.z<=i.z;return n&&r&&l}volume(){const t=this.lowerBound,e=this.upperBound;return(e.x-t.x)*(e.y-t.y)*(e.z-t.z)}contains(t){const e=this.lowerBound,i=this.upperBound,o=t.lowerBound,s=t.upperBound;return e.x<=o.x&&i.x>=s.x&&e.y<=o.y&&i.y>=s.y&&e.z<=o.z&&i.z>=s.z}getCorners(t,e,i,o,s,n,r,l){const a=this.lowerBound,c=this.upperBound;t.copy(a),e.set(c.x,a.y,a.z),i.set(c.x,c.y,a.z),o.set(a.x,c.y,c.z),s.set(c.x,a.y,c.z),n.set(a.x,c.y,a.z),r.set(a.x,a.y,c.z),l.copy(c)}toLocalFrame(t,e){const i=qi,o=i[0],s=i[1],n=i[2],r=i[3],l=i[4],a=i[5],c=i[6],u=i[7];this.getCorners(o,s,n,r,l,a,c,u);for(let d=0;d!==8;d++){const p=i[d];t.pointToLocal(p,p)}return e.setFromPoints(i)}toWorldFrame(t,e){const i=qi,o=i[0],s=i[1],n=i[2],r=i[3],l=i[4],a=i[5],c=i[6],u=i[7];this.getCorners(o,s,n,r,l,a,c,u);for(let d=0;d!==8;d++){const p=i[d];t.pointToWorld(p,p)}return e.setFromPoints(i)}overlapsRay(t){const{direction:e,from:i}=t,o=1/e.x,s=1/e.y,n=1/e.z,r=(this.lowerBound.x-i.x)*o,l=(this.upperBound.x-i.x)*o,a=(this.lowerBound.y-i.y)*s,c=(this.upperBound.y-i.y)*s,u=(this.lowerBound.z-i.z)*n,d=(this.upperBound.z-i.z)*n,p=Math.max(Math.max(Math.min(r,l),Math.min(a,c)),Math.min(u,d)),m=Math.min(Math.min(Math.max(r,l),Math.max(a,c)),Math.max(u,d));return!(m<0||p>m)}}const ki=new h,qi=[new h,new h,new h,new h,new h,new h,new h,new h];class Li{constructor(){this.matrix=[]}get(t,e){let{index:i}=t,{index:o}=e;if(o>i){const s=o;o=i,i=s}return this.matrix[(i*(i+1)>>1)+o-1]}set(t,e,i){let{index:o}=t,{index:s}=e;if(s>o){const n=s;s=o,o=n}this.matrix[(o*(o+1)>>1)+s-1]=i?1:0}reset(){for(let t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0}setNumObjects(t){this.matrix.length=t*(t-1)>>1}}class ji{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;return i[t]===void 0&&(i[t]=[]),i[t].includes(e)||i[t].push(e),this}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return!!(i[t]!==void 0&&i[t].includes(e))}hasAnyEventListener(t){return this._listeners===void 0?!1:this._listeners[t]!==void 0}removeEventListener(t,e){if(this._listeners===void 0)return this;const i=this._listeners;if(i[t]===void 0)return this;const o=i[t].indexOf(e);return o!==-1&&i[t].splice(o,1),this}dispatchEvent(t){if(this._listeners===void 0)return this;const e=this._listeners[t.type];if(e!==void 0){t.target=this;for(let i=0,o=e.length;i<o;i++)e[i].call(this,t)}return this}}class tt{constructor(t,e,i,o){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),o===void 0&&(o=1),this.x=t,this.y=e,this.z=i,this.w=o}set(t,e,i,o){return this.x=t,this.y=e,this.z=i,this.w=o,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(t,e){const i=Math.sin(e*.5);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=Math.cos(e*.5),this}toAxisAngle(t){t===void 0&&(t=new h),this.normalize();const e=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/i,t.y=this.y/i,t.z=this.z/i),[t,e]}setFromVectors(t,e){if(t.isAntiparallelTo(e)){const i=sn,o=nn;t.tangents(i,o),this.setFromAxisAngle(i,Math.PI)}else{const i=t.cross(e);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(t.length()**2*e.length()**2)+t.dot(e),this.normalize()}return this}mult(t,e){e===void 0&&(e=new tt);const i=this.x,o=this.y,s=this.z,n=this.w,r=t.x,l=t.y,a=t.z,c=t.w;return e.x=i*c+n*r+o*a-s*l,e.y=o*c+n*l+s*r-i*a,e.z=s*c+n*a+i*l-o*r,e.w=n*c-i*r-o*l-s*a,e}inverse(t){t===void 0&&(t=new tt);const e=this.x,i=this.y,o=this.z,s=this.w;this.conjugate(t);const n=1/(e*e+i*i+o*o+s*s);return t.x*=n,t.y*=n,t.z*=n,t.w*=n,t}conjugate(t){return t===void 0&&(t=new tt),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}normalizeFast(){const t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return t===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}vmult(t,e){e===void 0&&(e=new h);const i=t.x,o=t.y,s=t.z,n=this.x,r=this.y,l=this.z,a=this.w,c=a*i+r*s-l*o,u=a*o+l*i-n*s,d=a*s+n*o-r*i,p=-n*i-r*o-l*s;return e.x=c*a+p*-n+u*-l-d*-r,e.y=u*a+p*-r+d*-n-c*-l,e.z=d*a+p*-l+c*-r-u*-n,e}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}toEuler(t,e){e===void 0&&(e="YZX");let i,o,s;const n=this.x,r=this.y,l=this.z,a=this.w;switch(e){case"YZX":const c=n*r+l*a;if(c>.499&&(i=2*Math.atan2(n,a),o=Math.PI/2,s=0),c<-.499&&(i=-2*Math.atan2(n,a),o=-Math.PI/2,s=0),i===void 0){const u=n*n,d=r*r,p=l*l;i=Math.atan2(2*r*a-2*n*l,1-2*d-2*p),o=Math.asin(2*c),s=Math.atan2(2*n*a-2*r*l,1-2*u-2*p)}break;default:throw new Error(`Euler order ${e} not supported yet.`)}t.y=i,t.z=o,t.x=s}setFromEuler(t,e,i,o){o===void 0&&(o="XYZ");const s=Math.cos(t/2),n=Math.cos(e/2),r=Math.cos(i/2),l=Math.sin(t/2),a=Math.sin(e/2),c=Math.sin(i/2);return o==="XYZ"?(this.x=l*n*r+s*a*c,this.y=s*a*r-l*n*c,this.z=s*n*c+l*a*r,this.w=s*n*r-l*a*c):o==="YXZ"?(this.x=l*n*r+s*a*c,this.y=s*a*r-l*n*c,this.z=s*n*c-l*a*r,this.w=s*n*r+l*a*c):o==="ZXY"?(this.x=l*n*r-s*a*c,this.y=s*a*r+l*n*c,this.z=s*n*c+l*a*r,this.w=s*n*r-l*a*c):o==="ZYX"?(this.x=l*n*r-s*a*c,this.y=s*a*r+l*n*c,this.z=s*n*c-l*a*r,this.w=s*n*r+l*a*c):o==="YZX"?(this.x=l*n*r+s*a*c,this.y=s*a*r+l*n*c,this.z=s*n*c-l*a*r,this.w=s*n*r-l*a*c):o==="XZY"&&(this.x=l*n*r-s*a*c,this.y=s*a*r-l*n*c,this.z=s*n*c+l*a*r,this.w=s*n*r+l*a*c),this}clone(){return new tt(this.x,this.y,this.z,this.w)}slerp(t,e,i){i===void 0&&(i=new tt);const o=this.x,s=this.y,n=this.z,r=this.w;let l=t.x,a=t.y,c=t.z,u=t.w,d,p,m,y,v;return p=o*l+s*a+n*c+r*u,p<0&&(p=-p,l=-l,a=-a,c=-c,u=-u),1-p>1e-6?(d=Math.acos(p),m=Math.sin(d),y=Math.sin((1-e)*d)/m,v=Math.sin(e*d)/m):(y=1-e,v=e),i.x=y*o+v*l,i.y=y*s+v*a,i.z=y*n+v*c,i.w=y*r+v*u,i}integrate(t,e,i,o){o===void 0&&(o=new tt);const s=t.x*i.x,n=t.y*i.y,r=t.z*i.z,l=this.x,a=this.y,c=this.z,u=this.w,d=e*.5;return o.x+=d*(s*u+n*c-r*a),o.y+=d*(n*u+r*l-s*c),o.z+=d*(r*u+s*a-n*l),o.w+=d*(-s*l-n*a-r*c),o}}const sn=new h,nn=new h,rn={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class q{constructor(t){t===void 0&&(t={}),this.id=q.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=t.collisionResponse?t.collisionResponse:!0,this.collisionFilterGroup=t.collisionFilterGroup!==void 0?t.collisionFilterGroup:1,this.collisionFilterMask=t.collisionFilterMask!==void 0?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(t,e){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(t,e,i,o){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}q.idCounter=0,q.types=rn;class X{constructor(t){t===void 0&&(t={}),this.position=new h,this.quaternion=new tt,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}pointToLocal(t,e){return X.pointToLocalFrame(this.position,this.quaternion,t,e)}pointToWorld(t,e){return X.pointToWorldFrame(this.position,this.quaternion,t,e)}vectorToWorldFrame(t,e){return e===void 0&&(e=new h),this.quaternion.vmult(t,e),e}static pointToLocalFrame(t,e,i,o){return o===void 0&&(o=new h),i.vsub(t,o),e.conjugate(Oi),Oi.vmult(o,o),o}static pointToWorldFrame(t,e,i,o){return o===void 0&&(o=new h),e.vmult(i,o),o.vadd(t,o),o}static vectorToWorldFrame(t,e,i){return i===void 0&&(i=new h),t.vmult(e,i),i}static vectorToLocalFrame(t,e,i,o){return o===void 0&&(o=new h),e.w*=-1,e.vmult(i,o),e.w*=-1,o}}const Oi=new tt;class ie extends q{constructor(t){t===void 0&&(t={});const{vertices:e=[],faces:i=[],normals:o=[],axes:s,boundingSphereRadius:n}=t;super({type:q.types.CONVEXPOLYHEDRON}),this.vertices=e,this.faces=i,this.faceNormals=o,this.faceNormals.length===0&&this.computeNormals(),n?this.boundingSphereRadius=n:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=s?s.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const t=this.faces,e=this.vertices,i=this.uniqueEdges;i.length=0;const o=new h;for(let s=0;s!==t.length;s++){const n=t[s],r=n.length;for(let l=0;l!==r;l++){const a=(l+1)%r;e[n[l]].vsub(e[n[a]],o),o.normalize();let c=!1;for(let u=0;u!==i.length;u++)if(i[u].almostEquals(o)||i[u].almostEquals(o)){c=!0;break}c||i.push(o.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let t=0;t<this.faces.length;t++){for(let o=0;o<this.faces[t].length;o++)if(!this.vertices[this.faces[t][o]])throw new Error(`Vertex ${this.faces[t][o]} not found!`);const e=this.faceNormals[t]||new h;this.getFaceNormal(t,e),e.negate(e),this.faceNormals[t]=e;const i=this.vertices[this.faces[t][0]];if(e.dot(i)<0){console.error(`.faceNormals[${t}] = Vec3(${e.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let o=0;o<this.faces[t].length;o++)console.warn(`.vertices[${this.faces[t][o]}] = Vec3(${this.vertices[this.faces[t][o]].toString()})`)}}}getFaceNormal(t,e){const i=this.faces[t],o=this.vertices[i[0]],s=this.vertices[i[1]],n=this.vertices[i[2]];ie.computeNormal(o,s,n,e)}static computeNormal(t,e,i,o){const s=new h,n=new h;e.vsub(t,n),i.vsub(e,s),s.cross(n,o),o.isZero()||o.normalize()}clipAgainstHull(t,e,i,o,s,n,r,l,a){const c=new h;let u=-1,d=-Number.MAX_VALUE;for(let m=0;m<i.faces.length;m++){c.copy(i.faceNormals[m]),s.vmult(c,c);const y=c.dot(n);y>d&&(d=y,u=m)}const p=[];for(let m=0;m<i.faces[u].length;m++){const y=i.vertices[i.faces[u][m]],v=new h;v.copy(y),s.vmult(v,v),o.vadd(v,v),p.push(v)}u>=0&&this.clipFaceAgainstHull(n,t,e,p,r,l,a)}findSeparatingAxis(t,e,i,o,s,n,r,l){const a=new h,c=new h,u=new h,d=new h,p=new h,m=new h;let y=Number.MAX_VALUE;const v=this;if(v.uniqueAxes)for(let g=0;g!==v.uniqueAxes.length;g++){i.vmult(v.uniqueAxes[g],a);const f=v.testSepAxis(a,t,e,i,o,s);if(f===!1)return!1;f<y&&(y=f,n.copy(a))}else{const g=r?r.length:v.faces.length;for(let f=0;f<g;f++){const w=r?r[f]:f;a.copy(v.faceNormals[w]),i.vmult(a,a);const S=v.testSepAxis(a,t,e,i,o,s);if(S===!1)return!1;S<y&&(y=S,n.copy(a))}}if(t.uniqueAxes)for(let g=0;g!==t.uniqueAxes.length;g++){s.vmult(t.uniqueAxes[g],c);const f=v.testSepAxis(c,t,e,i,o,s);if(f===!1)return!1;f<y&&(y=f,n.copy(c))}else{const g=l?l.length:t.faces.length;for(let f=0;f<g;f++){const w=l?l[f]:f;c.copy(t.faceNormals[w]),s.vmult(c,c);const S=v.testSepAxis(c,t,e,i,o,s);if(S===!1)return!1;S<y&&(y=S,n.copy(c))}}for(let g=0;g!==v.uniqueEdges.length;g++){i.vmult(v.uniqueEdges[g],d);for(let f=0;f!==t.uniqueEdges.length;f++)if(s.vmult(t.uniqueEdges[f],p),d.cross(p,m),!m.almostZero()){m.normalize();const w=v.testSepAxis(m,t,e,i,o,s);if(w===!1)return!1;w<y&&(y=w,n.copy(m))}}return o.vsub(e,u),u.dot(n)>0&&n.negate(n),!0}testSepAxis(t,e,i,o,s,n){const r=this;ie.project(r,t,i,o,Ke),ie.project(e,t,s,n,Ze);const l=Ke[0],a=Ke[1],c=Ze[0],u=Ze[1];if(l<u||c<a)return!1;const d=l-u,p=c-a;return d<p?d:p}calculateLocalInertia(t,e){const i=new h,o=new h;this.computeLocalAABB(o,i);const s=i.x-o.x,n=i.y-o.y,r=i.z-o.z;e.x=1/12*t*(2*n*2*n+2*r*2*r),e.y=1/12*t*(2*s*2*s+2*r*2*r),e.z=1/12*t*(2*n*2*n+2*s*2*s)}getPlaneConstantOfFace(t){const e=this.faces[t],i=this.faceNormals[t],o=this.vertices[e[0]];return-i.dot(o)}clipFaceAgainstHull(t,e,i,o,s,n,r){const l=new h,a=new h,c=new h,u=new h,d=new h,p=new h,m=new h,y=new h,v=this,g=[],f=o,w=g;let S=-1,P=Number.MAX_VALUE;for(let C=0;C<v.faces.length;C++){l.copy(v.faceNormals[C]),i.vmult(l,l);const I=l.dot(t);I<P&&(P=I,S=C)}if(S<0)return;const B=v.faces[S];B.connectedFaces=[];for(let C=0;C<v.faces.length;C++)for(let I=0;I<v.faces[C].length;I++)B.indexOf(v.faces[C][I])!==-1&&C!==S&&B.connectedFaces.indexOf(C)===-1&&B.connectedFaces.push(C);const k=B.length;for(let C=0;C<k;C++){const I=v.vertices[B[C]],z=v.vertices[B[(C+1)%k]];I.vsub(z,a),c.copy(a),i.vmult(c,c),e.vadd(c,c),u.copy(this.faceNormals[S]),i.vmult(u,u),e.vadd(u,u),c.cross(u,d),d.negate(d),p.copy(I),i.vmult(p,p),e.vadd(p,p);const b=B.connectedFaces[C];m.copy(this.faceNormals[b]);const R=this.getPlaneConstantOfFace(b);y.copy(m),i.vmult(y,y);const M=R-y.dot(e);for(this.clipFaceAgainstPlane(f,w,y,M);f.length;)f.shift();for(;w.length;)f.push(w.shift())}m.copy(this.faceNormals[S]);const T=this.getPlaneConstantOfFace(S);y.copy(m),i.vmult(y,y);const x=T-y.dot(e);for(let C=0;C<f.length;C++){let I=y.dot(f[C])+x;if(I<=s&&(console.log(`clamped: depth=${I} to minDist=${s}`),I=s),I<=n){const z=f[C];if(I<=1e-6){const b={point:z,normal:y,depth:I};r.push(b)}}}}clipFaceAgainstPlane(t,e,i,o){let s,n;const r=t.length;if(r<2)return e;let l=t[t.length-1],a=t[0];s=i.dot(l)+o;for(let c=0;c<r;c++){if(a=t[c],n=i.dot(a)+o,s<0)if(n<0){const u=new h;u.copy(a),e.push(u)}else{const u=new h;l.lerp(a,s/(s-n),u),e.push(u)}else if(n<0){const u=new h;l.lerp(a,s/(s-n),u),e.push(u),e.push(a)}l=a,s=n}return e}computeWorldVertices(t,e){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new h);const i=this.vertices,o=this.worldVertices;for(let s=0;s!==this.vertices.length;s++)e.vmult(i[s],o[s]),t.vadd(o[s],o[s]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(t,e){const i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let o=0;o<this.vertices.length;o++){const s=i[o];s.x<t.x?t.x=s.x:s.x>e.x&&(e.x=s.x),s.y<t.y?t.y=s.y:s.y>e.y&&(e.y=s.y),s.z<t.z?t.z=s.z:s.z>e.z&&(e.z=s.z)}}computeWorldFaceNormals(t){const e=this.faceNormals.length;for(;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new h);const i=this.faceNormals,o=this.worldFaceNormals;for(let s=0;s!==e;s++)t.vmult(i[s],o[s]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let t=0;const e=this.vertices;for(let i=0;i!==e.length;i++){const o=e[i].lengthSquared();o>t&&(t=o)}this.boundingSphereRadius=Math.sqrt(t)}calculateWorldAABB(t,e,i,o){const s=this.vertices;let n,r,l,a,c,u,d=new h;for(let p=0;p<s.length;p++){d.copy(s[p]),e.vmult(d,d),t.vadd(d,d);const m=d;(n===void 0||m.x<n)&&(n=m.x),(a===void 0||m.x>a)&&(a=m.x),(r===void 0||m.y<r)&&(r=m.y),(c===void 0||m.y>c)&&(c=m.y),(l===void 0||m.z<l)&&(l=m.z),(u===void 0||m.z>u)&&(u=m.z)}i.set(n,r,l),o.set(a,c,u)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(t){t===void 0&&(t=new h);const e=this.vertices;for(let i=0;i<e.length;i++)t.vadd(e[i],t);return t.scale(1/e.length,t),t}transformAllPoints(t,e){const i=this.vertices.length,o=this.vertices;if(e){for(let s=0;s<i;s++){const n=o[s];e.vmult(n,n)}for(let s=0;s<this.faceNormals.length;s++){const n=this.faceNormals[s];e.vmult(n,n)}}if(t)for(let s=0;s<i;s++){const n=o[s];n.vadd(t,n)}}pointIsInside(t){const e=this.vertices,i=this.faces,o=this.faceNormals,s=null,n=new h;this.getAveragePointLocal(n);for(let r=0;r<this.faces.length;r++){let l=o[r];const a=e[i[r][0]],c=new h;t.vsub(a,c);const u=l.dot(c),d=new h;n.vsub(a,d);const p=l.dot(d);if(u<0&&p>0||u>0&&p<0)return!1}return s?1:-1}static project(t,e,i,o,s){const n=t.vertices.length,r=an;let l=0,a=0;const c=ln,u=t.vertices;c.setZero(),X.vectorToLocalFrame(i,o,e,r),X.pointToLocalFrame(i,o,c,c);const d=c.dot(r);a=l=u[0].dot(r);for(let p=1;p<n;p++){const m=u[p].dot(r);m>l&&(l=m),m<a&&(a=m)}if(a-=d,l-=d,a>l){const p=a;a=l,l=p}s[0]=l,s[1]=a}}const Ke=[],Ze=[];new h;const an=new h,ln=new h;class oe extends q{constructor(t){super({type:q.types.BOX}),this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const t=this.halfExtents.x,e=this.halfExtents.y,i=this.halfExtents.z,o=h,s=[new o(-t,-e,-i),new o(t,-e,-i),new o(t,e,-i),new o(-t,e,-i),new o(-t,-e,i),new o(t,-e,i),new o(t,e,i),new o(-t,e,i)],n=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],r=[new o(0,0,1),new o(0,1,0),new o(1,0,0)],l=new ie({vertices:s,faces:n,axes:r});this.convexPolyhedronRepresentation=l,l.material=this.material}calculateLocalInertia(t,e){return e===void 0&&(e=new h),oe.calculateInertia(this.halfExtents,t,e),e}static calculateInertia(t,e,i){const o=t;i.x=1/12*e*(2*o.y*2*o.y+2*o.z*2*o.z),i.y=1/12*e*(2*o.x*2*o.x+2*o.z*2*o.z),i.z=1/12*e*(2*o.y*2*o.y+2*o.x*2*o.x)}getSideNormals(t,e){const i=t,o=this.halfExtents;if(i[0].set(o.x,0,0),i[1].set(0,o.y,0),i[2].set(0,0,o.z),i[3].set(-o.x,0,0),i[4].set(0,-o.y,0),i[5].set(0,0,-o.z),e!==void 0)for(let s=0;s!==i.length;s++)e.vmult(i[s],i[s]);return i}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(t,e,i){const o=this.halfExtents,s=[[o.x,o.y,o.z],[-o.x,o.y,o.z],[-o.x,-o.y,o.z],[-o.x,-o.y,-o.z],[o.x,-o.y,-o.z],[o.x,o.y,-o.z],[-o.x,o.y,-o.z],[o.x,-o.y,o.z]];for(let n=0;n<s.length;n++)Nt.set(s[n][0],s[n][1],s[n][2]),e.vmult(Nt,Nt),t.vadd(Nt,Nt),i(Nt.x,Nt.y,Nt.z)}calculateWorldAABB(t,e,i,o){const s=this.halfExtents;bt[0].set(s.x,s.y,s.z),bt[1].set(-s.x,s.y,s.z),bt[2].set(-s.x,-s.y,s.z),bt[3].set(-s.x,-s.y,-s.z),bt[4].set(s.x,-s.y,-s.z),bt[5].set(s.x,s.y,-s.z),bt[6].set(-s.x,s.y,-s.z),bt[7].set(s.x,-s.y,s.z);const n=bt[0];e.vmult(n,n),t.vadd(n,n),o.copy(n),i.copy(n);for(let r=1;r<8;r++){const l=bt[r];e.vmult(l,l),t.vadd(l,l);const a=l.x,c=l.y,u=l.z;a>o.x&&(o.x=a),c>o.y&&(o.y=c),u>o.z&&(o.z=u),a<i.x&&(i.x=a),c<i.y&&(i.y=c),u<i.z&&(i.z=u)}}}const Nt=new h,bt=[new h,new h,new h,new h,new h,new h,new h,new h],Qe={DYNAMIC:1,STATIC:2,KINEMATIC:4},Je={AWAKE:0,SLEEPY:1,SLEEPING:2};class L extends ji{constructor(t){t===void 0&&(t={}),super(),this.id=L.idCounter++,this.index=-1,this.world=null,this.vlambda=new h,this.collisionFilterGroup=typeof t.collisionFilterGroup=="number"?t.collisionFilterGroup:1,this.collisionFilterMask=typeof t.collisionFilterMask=="number"?t.collisionFilterMask:-1,this.collisionResponse=typeof t.collisionResponse=="boolean"?t.collisionResponse:!0,this.position=new h,this.previousPosition=new h,this.interpolatedPosition=new h,this.initPosition=new h,t.position&&(this.position.copy(t.position),this.previousPosition.copy(t.position),this.interpolatedPosition.copy(t.position),this.initPosition.copy(t.position)),this.velocity=new h,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new h,this.force=new h;const e=typeof t.mass=="number"?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping=typeof t.linearDamping=="number"?t.linearDamping:.01,this.type=e<=0?L.STATIC:L.DYNAMIC,typeof t.type==typeof L.STATIC&&(this.type=t.type),this.allowSleep=typeof t.allowSleep<"u"?t.allowSleep:!0,this.sleepState=L.AWAKE,this.sleepSpeedLimit=typeof t.sleepSpeedLimit<"u"?t.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof t.sleepTimeLimit<"u"?t.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new h,this.quaternion=new tt,this.initQuaternion=new tt,this.previousQuaternion=new tt,this.interpolatedQuaternion=new tt,t.quaternion&&(this.quaternion.copy(t.quaternion),this.initQuaternion.copy(t.quaternion),this.previousQuaternion.copy(t.quaternion),this.interpolatedQuaternion.copy(t.quaternion)),this.angularVelocity=new h,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new h,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new h,this.invInertia=new h,this.invInertiaWorld=new ft,this.invMassSolve=0,this.invInertiaSolve=new h,this.invInertiaWorldSolve=new ft,this.fixedRotation=typeof t.fixedRotation<"u"?t.fixedRotation:!1,this.angularDamping=typeof t.angularDamping<"u"?t.angularDamping:.01,this.linearFactor=new h(1,1,1),t.linearFactor&&this.linearFactor.copy(t.linearFactor),this.angularFactor=new h(1,1,1),t.angularFactor&&this.angularFactor.copy(t.angularFactor),this.aabb=new ut,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new h,this.isTrigger=!!t.isTrigger,t.shape&&this.addShape(t.shape),this.updateMassProperties()}wakeUp(){const t=this.sleepState;this.sleepState=L.AWAKE,this.wakeUpAfterNarrowphase=!1,t===L.SLEEPING&&this.dispatchEvent(L.wakeupEvent)}sleep(){this.sleepState=L.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(t){if(this.allowSleep){const e=this.sleepState,i=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),o=this.sleepSpeedLimit**2;e===L.AWAKE&&i<o?(this.sleepState=L.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(L.sleepyEvent)):e===L.SLEEPY&&i>o?this.wakeUp():e===L.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(L.sleepEvent))}}updateSolveMassProperties(){this.sleepState===L.SLEEPING||this.type===L.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(t,e){return e===void 0&&(e=new h),t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e}vectorToLocalFrame(t,e){return e===void 0&&(e=new h),this.quaternion.conjugate().vmult(t,e),e}pointToWorldFrame(t,e){return e===void 0&&(e=new h),this.quaternion.vmult(t,e),e.vadd(this.position,e),e}vectorToWorldFrame(t,e){return e===void 0&&(e=new h),this.quaternion.vmult(t,e),e}addShape(t,e,i){const o=new h,s=new tt;return e&&o.copy(e),i&&s.copy(i),this.shapes.push(t),this.shapeOffsets.push(o),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=this,this}removeShape(t){const e=this.shapes.indexOf(t);return e===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeOrientations.splice(e,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,t.body=null,this)}updateBoundingRadius(){const t=this.shapes,e=this.shapeOffsets,i=t.length;let o=0;for(let s=0;s!==i;s++){const n=t[s];n.updateBoundingSphereRadius();const r=e[s].length(),l=n.boundingSphereRadius;r+l>o&&(o=r+l)}this.boundingRadius=o}updateAABB(){const t=this.shapes,e=this.shapeOffsets,i=this.shapeOrientations,o=t.length,s=cn,n=hn,r=this.quaternion,l=this.aabb,a=dn;for(let c=0;c!==o;c++){const u=t[c];r.vmult(e[c],s),s.vadd(this.position,s),r.mult(i[c],n),u.calculateWorldAABB(s,n,a.lowerBound,a.upperBound),c===0?l.copy(a):l.extend(a)}this.aabbNeedsUpdate=!1}updateInertiaWorld(t){const e=this.invInertia;if(!(e.x===e.y&&e.y===e.z&&!t)){const i=un,o=pn;i.setRotationFromQuaternion(this.quaternion),i.transpose(o),i.scale(e,i),i.mmult(o,this.invInertiaWorld)}}applyForce(t,e){if(e===void 0&&(e=new h),this.type!==L.DYNAMIC)return;this.sleepState===L.SLEEPING&&this.wakeUp();const i=yn;e.cross(t,i),this.force.vadd(t,this.force),this.torque.vadd(i,this.torque)}applyLocalForce(t,e){if(e===void 0&&(e=new h),this.type!==L.DYNAMIC)return;const i=mn,o=vn;this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(e,o),this.applyForce(i,o)}applyTorque(t){this.type===L.DYNAMIC&&(this.sleepState===L.SLEEPING&&this.wakeUp(),this.torque.vadd(t,this.torque))}applyImpulse(t,e){if(e===void 0&&(e=new h),this.type!==L.DYNAMIC)return;this.sleepState===L.SLEEPING&&this.wakeUp();const i=e,o=fn;o.copy(t),o.scale(this.invMass,o),this.velocity.vadd(o,this.velocity);const s=gn;i.cross(t,s),this.invInertiaWorld.vmult(s,s),this.angularVelocity.vadd(s,this.angularVelocity)}applyLocalImpulse(t,e){if(e===void 0&&(e=new h),this.type!==L.DYNAMIC)return;const i=wn,o=xn;this.vectorToWorldFrame(t,i),this.vectorToWorldFrame(e,o),this.applyImpulse(i,o)}updateMassProperties(){const t=bn;this.invMass=this.mass>0?1/this.mass:0;const e=this.inertia,i=this.fixedRotation;this.updateAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),oe.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!i?1/e.x:0,e.y>0&&!i?1/e.y:0,e.z>0&&!i?1/e.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(t,e){const i=new h;return t.vsub(this.position,i),this.angularVelocity.cross(i,e),this.velocity.vadd(e,e),e}integrate(t,e,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===L.DYNAMIC||this.type===L.KINEMATIC)||this.sleepState===L.SLEEPING)return;const o=this.velocity,s=this.angularVelocity,n=this.position,r=this.force,l=this.torque,a=this.quaternion,c=this.invMass,u=this.invInertiaWorld,d=this.linearFactor,p=c*t;o.x+=r.x*p*d.x,o.y+=r.y*p*d.y,o.z+=r.z*p*d.z;const m=u.elements,y=this.angularFactor,v=l.x*y.x,g=l.y*y.y,f=l.z*y.z;s.x+=t*(m[0]*v+m[1]*g+m[2]*f),s.y+=t*(m[3]*v+m[4]*g+m[5]*f),s.z+=t*(m[6]*v+m[7]*g+m[8]*f),n.x+=o.x*t,n.y+=o.y*t,n.z+=o.z*t,a.integrate(this.angularVelocity,t,this.angularFactor,a),e&&(i?a.normalizeFast():a.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}L.idCounter=0,L.COLLIDE_EVENT_NAME="collide",L.DYNAMIC=Qe.DYNAMIC,L.STATIC=Qe.STATIC,L.KINEMATIC=Qe.KINEMATIC,L.AWAKE=Je.AWAKE,L.SLEEPY=Je.SLEEPY,L.SLEEPING=Je.SLEEPING,L.wakeupEvent={type:"wakeup"},L.sleepyEvent={type:"sleepy"},L.sleepEvent={type:"sleep"};const cn=new h,hn=new tt,dn=new ut,un=new ft,pn=new ft,Bl=new ft,yn=new h,mn=new h,vn=new h,fn=new h,gn=new h,wn=new h,xn=new h,bn=new h;class En{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(t,e,i){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(t,e){return!(!(t.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&t.collisionFilterMask)||(t.type&L.STATIC||t.sleepState===L.SLEEPING)&&(e.type&L.STATIC||e.sleepState===L.SLEEPING))}intersectionTest(t,e,i,o){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,i,o):this.doBoundingSphereBroadphase(t,e,i,o)}doBoundingSphereBroadphase(t,e,i,o){const s=Sn;e.position.vsub(t.position,s);const n=(t.boundingRadius+e.boundingRadius)**2;s.lengthSquared()<n&&(i.push(t),o.push(e))}doBoundingBoxBroadphase(t,e,i,o){t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)&&(i.push(t),o.push(e))}makePairsUnique(t,e){const i=zn,o=Cn,s=An,n=t.length;for(let r=0;r!==n;r++)o[r]=t[r],s[r]=e[r];t.length=0,e.length=0;for(let r=0;r!==n;r++){const l=o[r].id,a=s[r].id,c=l<a?`${l},${a}`:`${a},${l}`;i[c]=r,i.keys.push(c)}for(let r=0;r!==i.keys.length;r++){const l=i.keys.pop(),a=i[l];t.push(o[a]),e.push(s[a]),delete i[l]}}setWorld(t){}static boundingSphereCheck(t,e){const i=new h;t.position.vsub(e.position,i);const o=t.shapes[0],s=e.shapes[0];return Math.pow(o.boundingSphereRadius+s.boundingSphereRadius,2)>i.lengthSquared()}aabbQuery(t,e,i){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Sn=new h;new h,new tt,new h;const zn={keys:[]},Cn=[],An=[];new h,new h,new h;class Tn extends En{constructor(){super()}collisionPairs(t,e,i){const o=t.bodies,s=o.length;let n,r;for(let l=0;l!==s;l++)for(let a=0;a!==l;a++)n=o[l],r=o[a],this.needBroadphaseCollision(n,r)&&this.intersectionTest(n,r,e,i)}aabbQuery(t,e,i){i===void 0&&(i=[]);for(let o=0;o<t.bodies.length;o++){const s=t.bodies[o];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(e)&&i.push(s)}return i}}class Ce{constructor(){this.rayFromWorld=new h,this.rayToWorld=new h,this.hitNormalWorld=new h,this.hitPointWorld=new h,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(t,e,i,o,s,n,r){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(o),this.shape=s,this.body=n,this.distance=r}}let Wi,Di,Gi,Vi,Hi,Yi,_i;const ti={CLOSEST:1,ANY:2,ALL:4};Wi=q.types.SPHERE,Di=q.types.PLANE,Gi=q.types.BOX,Vi=q.types.CYLINDER,Hi=q.types.CONVEXPOLYHEDRON,Yi=q.types.HEIGHTFIELD,_i=q.types.TRIMESH;class it{get[Wi](){return this._intersectSphere}get[Di](){return this._intersectPlane}get[Gi](){return this._intersectBox}get[Vi](){return this._intersectConvex}get[Hi](){return this._intersectConvex}get[Yi](){return this._intersectHeightfield}get[_i](){return this._intersectTrimesh}constructor(t,e){t===void 0&&(t=new h),e===void 0&&(e=new h),this.from=t.clone(),this.to=e.clone(),this.direction=new h,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=it.ANY,this.result=new Ce,this.hasHit=!1,this.callback=i=>{}}intersectWorld(t,e){return this.mode=e.mode||it.ANY,this.result=e.result||new Ce,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=typeof e.collisionFilterMask<"u"?e.collisionFilterMask:-1,this.collisionFilterGroup=typeof e.collisionFilterGroup<"u"?e.collisionFilterGroup:-1,this.checkCollisionResponse=typeof e.checkCollisionResponse<"u"?e.checkCollisionResponse:!0,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(Xi),ei.length=0,t.broadphase.aabbQuery(t,Xi,ei),this.intersectBodies(ei),this.hasHit}intersectBody(t,e){e&&(this.result=e,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!t.collisionResponse||!(this.collisionFilterGroup&t.collisionFilterMask)||!(t.collisionFilterGroup&this.collisionFilterMask))return;const o=Pn,s=Mn;for(let n=0,r=t.shapes.length;n<r;n++){const l=t.shapes[n];if(!(i&&!l.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[n],s),t.quaternion.vmult(t.shapeOffsets[n],o),o.vadd(t.position,o),this.intersectShape(l,s,o,t),this.result.shouldStop))break}}intersectBodies(t,e){e&&(this.result=e,this.updateDirection());for(let i=0,o=t.length;!this.result.shouldStop&&i<o;i++)this.intersectBody(t[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(t,e,i,o){const s=this.from;if(Vn(s,this.direction,i)>t.boundingSphereRadius)return;const n=this[t.type];n&&n.call(this,t,e,i,o,t)}_intersectBox(t,e,i,o,s){return this._intersectConvex(t.convexPolyhedronRepresentation,e,i,o,s)}_intersectPlane(t,e,i,o,s){const n=this.from,r=this.to,l=this.direction,a=new h(0,0,1);e.vmult(a,a);const c=new h;n.vsub(i,c);const u=c.dot(a);r.vsub(i,c);const d=c.dot(a);if(u*d>0||n.distanceTo(r)<u)return;const p=a.dot(l);if(Math.abs(p)<this.precision)return;const m=new h,y=new h,v=new h;n.vsub(i,m);const g=-a.dot(m)/p;l.scale(g,y),n.vadd(y,v),this.reportIntersection(a,v,s,o,-1)}getAABB(t){const{lowerBound:e,upperBound:i}=t,o=this.to,s=this.from;e.x=Math.min(o.x,s.x),e.y=Math.min(o.y,s.y),e.z=Math.min(o.z,s.z),i.x=Math.max(o.x,s.x),i.y=Math.max(o.y,s.y),i.z=Math.max(o.z,s.z)}_intersectHeightfield(t,e,i,o,s){t.data,t.elementSize;const n=Bn;n.from.copy(this.from),n.to.copy(this.to),X.pointToLocalFrame(i,e,n.from,n.from),X.pointToLocalFrame(i,e,n.to,n.to),n.updateDirection();const r=Fn;let l,a,c,u;l=a=0,c=u=t.data.length-1;const d=new ut;n.getAABB(d),t.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,r,!0),l=Math.max(l,r[0]),a=Math.max(a,r[1]),t.getIndexOfPosition(d.upperBound.x,d.upperBound.y,r,!0),c=Math.min(c,r[0]+1),u=Math.min(u,r[1]+1);for(let p=l;p<c;p++)for(let m=a;m<u;m++){if(this.result.shouldStop)return;if(t.getAabbAtIndex(p,m,d),!!d.overlapsRay(n)){if(t.getConvexTrianglePillar(p,m,!1),X.pointToWorldFrame(i,e,t.pillarOffset,Ae),this._intersectConvex(t.pillarConvex,e,Ae,o,s,Ui),this.result.shouldStop)return;t.getConvexTrianglePillar(p,m,!0),X.pointToWorldFrame(i,e,t.pillarOffset,Ae),this._intersectConvex(t.pillarConvex,e,Ae,o,s,Ui)}}}_intersectSphere(t,e,i,o,s){const n=this.from,r=this.to,l=t.radius,a=(r.x-n.x)**2+(r.y-n.y)**2+(r.z-n.z)**2,c=2*((r.x-n.x)*(n.x-i.x)+(r.y-n.y)*(n.y-i.y)+(r.z-n.z)*(n.z-i.z)),u=(n.x-i.x)**2+(n.y-i.y)**2+(n.z-i.z)**2-l**2,d=c**2-4*a*u,p=Rn,m=Nn;if(!(d<0))if(d===0)n.lerp(r,d,p),p.vsub(i,m),m.normalize(),this.reportIntersection(m,p,s,o,-1);else{const y=(-c-Math.sqrt(d))/(2*a),v=(-c+Math.sqrt(d))/(2*a);if(y>=0&&y<=1&&(n.lerp(r,y,p),p.vsub(i,m),m.normalize(),this.reportIntersection(m,p,s,o,-1)),this.result.shouldStop)return;v>=0&&v<=1&&(n.lerp(r,v,p),p.vsub(i,m),m.normalize(),this.reportIntersection(m,p,s,o,-1))}}_intersectConvex(t,e,i,o,s,n){const r=In,l=$i,a=n&&n.faceList||null,c=t.faces,u=t.vertices,d=t.faceNormals,p=this.direction,m=this.from,y=this.to,v=m.distanceTo(y),g=a?a.length:c.length,f=this.result;for(let w=0;!f.shouldStop&&w<g;w++){const S=a?a[w]:w,P=c[S],B=d[S],k=e,T=i;l.copy(u[P[0]]),k.vmult(l,l),l.vadd(T,l),l.vsub(m,l),k.vmult(B,r);const x=p.dot(r);if(Math.abs(x)<this.precision)continue;const C=r.dot(l)/x;if(!(C<0)){p.scale(C,ct),ct.vadd(m,ct),gt.copy(u[P[0]]),k.vmult(gt,gt),T.vadd(gt,gt);for(let I=1;!f.shouldStop&&I<P.length-1;I++){Et.copy(u[P[I]]),St.copy(u[P[I+1]]),k.vmult(Et,Et),k.vmult(St,St),T.vadd(Et,Et),T.vadd(St,St);const z=ct.distanceTo(m);!(it.pointInTriangle(ct,gt,Et,St)||it.pointInTriangle(ct,Et,gt,St))||z>v||this.reportIntersection(r,ct,s,o,S)}}}}_intersectTrimesh(t,e,i,o,s,n){const r=kn,l=Dn,a=Gn,c=$i,u=qn,d=Ln,p=jn,m=Wn,y=On,v=t.indices;t.vertices;const g=this.from,f=this.to,w=this.direction;a.position.copy(i),a.quaternion.copy(e),X.vectorToLocalFrame(i,e,w,u),X.pointToLocalFrame(i,e,g,d),X.pointToLocalFrame(i,e,f,p),p.x*=t.scale.x,p.y*=t.scale.y,p.z*=t.scale.z,d.x*=t.scale.x,d.y*=t.scale.y,d.z*=t.scale.z,p.vsub(d,u),u.normalize();const S=d.distanceSquared(p);t.tree.rayQuery(this,a,l);for(let P=0,B=l.length;!this.result.shouldStop&&P!==B;P++){const k=l[P];t.getNormal(k,r),t.getVertex(v[k*3],gt),gt.vsub(d,c);const T=u.dot(r),x=r.dot(c)/T;if(x<0)continue;u.scale(x,ct),ct.vadd(d,ct),t.getVertex(v[k*3+1],Et),t.getVertex(v[k*3+2],St);const C=ct.distanceSquared(d);!(it.pointInTriangle(ct,Et,gt,St)||it.pointInTriangle(ct,gt,Et,St))||C>S||(X.vectorToWorldFrame(e,r,y),X.pointToWorldFrame(i,e,ct,m),this.reportIntersection(y,m,s,o,k))}l.length=0}reportIntersection(t,e,i,o,s){const n=this.from,r=this.to,l=n.distanceTo(e),a=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(a.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case it.ALL:this.hasHit=!0,a.set(n,r,t,e,i,o,l),a.hasHit=!0,this.callback(a);break;case it.CLOSEST:(l<a.distance||!a.hasHit)&&(this.hasHit=!0,a.hasHit=!0,a.set(n,r,t,e,i,o,l));break;case it.ANY:this.hasHit=!0,a.hasHit=!0,a.set(n,r,t,e,i,o,l),a.shouldStop=!0;break}}static pointInTriangle(t,e,i,o){o.vsub(e,jt),i.vsub(e,se),t.vsub(e,ii);const s=jt.dot(jt),n=jt.dot(se),r=jt.dot(ii),l=se.dot(se),a=se.dot(ii);let c,u;return(c=l*r-n*a)>=0&&(u=s*a-n*r)>=0&&c+u<s*l-n*n}}it.CLOSEST=ti.CLOSEST,it.ANY=ti.ANY,it.ALL=ti.ALL;const Xi=new ut,ei=[],se=new h,ii=new h,Pn=new h,Mn=new tt,ct=new h,gt=new h,Et=new h,St=new h;new h,new Ce;const Ui={faceList:[0]},Ae=new h,Bn=new it,Fn=[],Rn=new h,Nn=new h,In=new h;new h,new h;const $i=new h,kn=new h,qn=new h,Ln=new h,jn=new h,On=new h,Wn=new h;new ut;const Dn=[],Gn=new X,jt=new h,Te=new h;function Vn(E,t,e){e.vsub(E,jt);const i=jt.dot(t);return t.scale(i,Te),Te.vadd(E,Te),e.distanceTo(Te)}class Hn{static defaults(t,e){t===void 0&&(t={});for(let i in e)i in t||(t[i]=e[i]);return t}}class Ki{constructor(){this.spatial=new h,this.rotational=new h}multiplyElement(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)}multiplyVectors(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}}class ne{constructor(t,e,i,o){i===void 0&&(i=-1e6),o===void 0&&(o=1e6),this.id=ne.idCounter++,this.minForce=i,this.maxForce=o,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Ki,this.jacobianElementB=new Ki,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(t,e,i){const o=e,s=t,n=i;this.a=4/(n*(1+4*o)),this.b=4*o/(1+4*o),this.eps=4/(n*n*s*(1+4*o))}computeB(t,e,i){const o=this.computeGW(),s=this.computeGq(),n=this.computeGiMf();return-s*t-o*e-n*i}computeGq(){const t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,o=this.bj,s=i.position,n=o.position;return t.spatial.dot(s)+e.spatial.dot(n)}computeGW(){const t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,o=this.bj,s=i.velocity,n=o.velocity,r=i.angularVelocity,l=o.angularVelocity;return t.multiplyVectors(s,r)+e.multiplyVectors(n,l)}computeGWlambda(){const t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,o=this.bj,s=i.vlambda,n=o.vlambda,r=i.wlambda,l=o.wlambda;return t.multiplyVectors(s,r)+e.multiplyVectors(n,l)}computeGiMf(){const t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,o=this.bj,s=i.force,n=i.torque,r=o.force,l=o.torque,a=i.invMassSolve,c=o.invMassSolve;return s.scale(a,Zi),r.scale(c,Qi),i.invInertiaWorldSolve.vmult(n,Ji),o.invInertiaWorldSolve.vmult(l,to),t.multiplyVectors(Zi,Ji)+e.multiplyVectors(Qi,to)}computeGiMGt(){const t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,o=this.bj,s=i.invMassSolve,n=o.invMassSolve,r=i.invInertiaWorldSolve,l=o.invInertiaWorldSolve;let a=s+n;return r.vmult(t.rotational,Pe),a+=Pe.dot(t.rotational),l.vmult(e.rotational,Pe),a+=Pe.dot(e.rotational),a}addToWlambda(t){const e=this.jacobianElementA,i=this.jacobianElementB,o=this.bi,s=this.bj,n=Yn;o.vlambda.addScaledVector(o.invMassSolve*t,e.spatial,o.vlambda),s.vlambda.addScaledVector(s.invMassSolve*t,i.spatial,s.vlambda),o.invInertiaWorldSolve.vmult(e.rotational,n),o.wlambda.addScaledVector(t,n,o.wlambda),s.invInertiaWorldSolve.vmult(i.rotational,n),s.wlambda.addScaledVector(t,n,s.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}ne.idCounter=0;const Zi=new h,Qi=new h,Ji=new h,to=new h,Pe=new h,Yn=new h;class _n extends ne{constructor(t,e,i){i===void 0&&(i=1e6),super(t,e,0,i),this.restitution=0,this.ri=new h,this.rj=new h,this.ni=new h}computeB(t){const e=this.a,i=this.b,o=this.bi,s=this.bj,n=this.ri,r=this.rj,l=Xn,a=Un,c=o.velocity,u=o.angularVelocity;o.force,o.torque;const d=s.velocity,p=s.angularVelocity;s.force,s.torque;const m=$n,y=this.jacobianElementA,v=this.jacobianElementB,g=this.ni;n.cross(g,l),r.cross(g,a),g.negate(y.spatial),l.negate(y.rotational),v.spatial.copy(g),v.rotational.copy(a),m.copy(s.position),m.vadd(r,m),m.vsub(o.position,m),m.vsub(n,m);const f=g.dot(m),w=this.restitution+1,S=w*d.dot(g)-w*c.dot(g)+p.dot(a)-u.dot(l),P=this.computeGiMf();return-f*e-S*i-t*P}getImpactVelocityAlongNormal(){const t=Kn,e=Zn,i=Qn,o=Jn,s=tr;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,o),this.bi.getVelocityAtWorldPoint(i,t),this.bj.getVelocityAtWorldPoint(o,e),t.vsub(e,s),this.ni.dot(s)}}const Xn=new h,Un=new h,$n=new h,Kn=new h,Zn=new h,Qn=new h,Jn=new h,tr=new h;new h,new h,new h,new h,new h,new h,new h,new h,new h,new h;class eo extends ne{constructor(t,e,i){super(t,e,-i,i),this.ri=new h,this.rj=new h,this.t=new h}computeB(t){this.a;const e=this.b;this.bi,this.bj;const i=this.ri,o=this.rj,s=er,n=ir,r=this.t;i.cross(r,s),o.cross(r,n);const l=this.jacobianElementA,a=this.jacobianElementB;r.negate(l.spatial),s.negate(l.rotational),a.spatial.copy(r),a.rotational.copy(n);const c=this.computeGW(),u=this.computeGiMf();return-c*e-t*u}}const er=new h,ir=new h;class Me{constructor(t,e,i){i=Hn.defaults(i,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Me.idCounter++,this.materials=[t,e],this.friction=i.friction,this.restitution=i.restitution,this.contactEquationStiffness=i.contactEquationStiffness,this.contactEquationRelaxation=i.contactEquationRelaxation,this.frictionEquationStiffness=i.frictionEquationStiffness,this.frictionEquationRelaxation=i.frictionEquationRelaxation}}Me.idCounter=0;class Be{constructor(t){t===void 0&&(t={});let e="";typeof t=="string"&&(e=t,t={}),this.name=e,this.id=Be.idCounter++,this.friction=typeof t.friction<"u"?t.friction:-1,this.restitution=typeof t.restitution<"u"?t.restitution:-1}}Be.idCounter=0,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new it,new h,new h,new h,new h(1,0,0),new h(0,1,0),new h(0,0,1),new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h;class Fe extends q{constructor(t){if(super({type:q.types.SPHERE}),this.radius=t!==void 0?t:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(t,e){e===void 0&&(e=new h);const i=2*t*this.radius*this.radius/5;return e.x=i,e.y=i,e.z=i,e}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(t,e,i,o){const s=this.radius,n=["x","y","z"];for(let r=0;r<n.length;r++){const l=n[r];i[l]=t[l]-s,o[l]=t[l]+s}}}new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new ut,new h,new ut,new h,new h,new h,new h,new h,new h,new h,new ut,new h,new X,new ut;class or{constructor(){this.equations=[]}solve(t,e){return 0}addEquation(t){t.enabled&&!t.bi.isTrigger&&!t.bj.isTrigger&&this.equations.push(t)}removeEquation(t){const e=this.equations,i=e.indexOf(t);i!==-1&&e.splice(i,1)}removeAllEquations(){this.equations.length=0}}class sr extends or{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(t,e){let i=0;const o=this.iterations,s=this.tolerance*this.tolerance,n=this.equations,r=n.length,l=e.bodies,a=l.length,c=t;let u,d,p,m,y,v;if(r!==0)for(let S=0;S!==a;S++)l[S].updateSolveMassProperties();const g=rr,f=ar,w=nr;g.length=r,f.length=r,w.length=r;for(let S=0;S!==r;S++){const P=n[S];w[S]=0,f[S]=P.computeB(c),g[S]=1/P.computeC()}if(r!==0){for(let B=0;B!==a;B++){const k=l[B],T=k.vlambda,x=k.wlambda;T.set(0,0,0),x.set(0,0,0)}for(i=0;i!==o;i++){m=0;for(let B=0;B!==r;B++){const k=n[B];u=f[B],d=g[B],v=w[B],y=k.computeGWlambda(),p=d*(u-y-k.eps*v),v+p<k.minForce?p=k.minForce-v:v+p>k.maxForce&&(p=k.maxForce-v),w[B]+=p,m+=p>0?p:-p,k.addToWlambda(p)}if(m*m<s)break}for(let B=0;B!==a;B++){const k=l[B],T=k.velocity,x=k.angularVelocity;k.vlambda.vmul(k.linearFactor,k.vlambda),T.vadd(k.vlambda,T),k.wlambda.vmul(k.angularFactor,k.wlambda),x.vadd(k.wlambda,x)}let S=n.length;const P=1/c;for(;S--;)n[S].multiplier=w[S]*P}return i}}const nr=[],rr=[],ar=[];L.STATIC;class lr{constructor(){this.objects=[],this.type=Object}release(){const t=arguments.length;for(let e=0;e!==t;e++)this.objects.push(e<0||arguments.length<=e?void 0:arguments[e]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(t){const e=this.objects;for(;e.length>t;)e.pop();for(;e.length<t;)e.push(this.constructObject());return this}}class cr extends lr{constructor(){super(...arguments),this.type=h}constructObject(){return new h}}const K={sphereSphere:q.types.SPHERE,spherePlane:q.types.SPHERE|q.types.PLANE,boxBox:q.types.BOX|q.types.BOX,sphereBox:q.types.SPHERE|q.types.BOX,planeBox:q.types.PLANE|q.types.BOX,convexConvex:q.types.CONVEXPOLYHEDRON,sphereConvex:q.types.SPHERE|q.types.CONVEXPOLYHEDRON,planeConvex:q.types.PLANE|q.types.CONVEXPOLYHEDRON,boxConvex:q.types.BOX|q.types.CONVEXPOLYHEDRON,sphereHeightfield:q.types.SPHERE|q.types.HEIGHTFIELD,boxHeightfield:q.types.BOX|q.types.HEIGHTFIELD,convexHeightfield:q.types.CONVEXPOLYHEDRON|q.types.HEIGHTFIELD,sphereParticle:q.types.PARTICLE|q.types.SPHERE,planeParticle:q.types.PLANE|q.types.PARTICLE,boxParticle:q.types.BOX|q.types.PARTICLE,convexParticle:q.types.PARTICLE|q.types.CONVEXPOLYHEDRON,cylinderCylinder:q.types.CYLINDER,sphereCylinder:q.types.SPHERE|q.types.CYLINDER,planeCylinder:q.types.PLANE|q.types.CYLINDER,boxCylinder:q.types.BOX|q.types.CYLINDER,convexCylinder:q.types.CONVEXPOLYHEDRON|q.types.CYLINDER,heightfieldCylinder:q.types.HEIGHTFIELD|q.types.CYLINDER,particleCylinder:q.types.PARTICLE|q.types.CYLINDER,sphereTrimesh:q.types.SPHERE|q.types.TRIMESH,planeTrimesh:q.types.PLANE|q.types.TRIMESH};class hr{get[K.sphereSphere](){return this.sphereSphere}get[K.spherePlane](){return this.spherePlane}get[K.boxBox](){return this.boxBox}get[K.sphereBox](){return this.sphereBox}get[K.planeBox](){return this.planeBox}get[K.convexConvex](){return this.convexConvex}get[K.sphereConvex](){return this.sphereConvex}get[K.planeConvex](){return this.planeConvex}get[K.boxConvex](){return this.boxConvex}get[K.sphereHeightfield](){return this.sphereHeightfield}get[K.boxHeightfield](){return this.boxHeightfield}get[K.convexHeightfield](){return this.convexHeightfield}get[K.sphereParticle](){return this.sphereParticle}get[K.planeParticle](){return this.planeParticle}get[K.boxParticle](){return this.boxParticle}get[K.convexParticle](){return this.convexParticle}get[K.cylinderCylinder](){return this.convexConvex}get[K.sphereCylinder](){return this.sphereConvex}get[K.planeCylinder](){return this.planeConvex}get[K.boxCylinder](){return this.boxConvex}get[K.convexCylinder](){return this.convexConvex}get[K.heightfieldCylinder](){return this.heightfieldCylinder}get[K.particleCylinder](){return this.particleCylinder}get[K.sphereTrimesh](){return this.sphereTrimesh}get[K.planeTrimesh](){return this.planeTrimesh}constructor(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new cr,this.world=t,this.currentContactMaterial=t.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(t,e,i,o,s,n){let r;this.contactPointPool.length?(r=this.contactPointPool.pop(),r.bi=t,r.bj=e):r=new _n(t,e),r.enabled=t.collisionResponse&&e.collisionResponse&&i.collisionResponse&&o.collisionResponse;const l=this.currentContactMaterial;r.restitution=l.restitution,r.setSpookParams(l.contactEquationStiffness,l.contactEquationRelaxation,this.world.dt);const a=i.material||t.material,c=o.material||e.material;return a&&c&&a.restitution>=0&&c.restitution>=0&&(r.restitution=a.restitution*c.restitution),r.si=s||i,r.sj=n||o,r}createFrictionEquationsFromContact(t,e){const i=t.bi,o=t.bj,s=t.si,n=t.sj,r=this.world,l=this.currentContactMaterial;let a=l.friction;const c=s.material||i.material,u=n.material||o.material;if(c&&u&&c.friction>=0&&u.friction>=0&&(a=c.friction*u.friction),a>0){const d=a*(r.frictionGravity||r.gravity).length();let p=i.invMass+o.invMass;p>0&&(p=1/p);const m=this.frictionEquationPool,y=m.length?m.pop():new eo(i,o,d*p),v=m.length?m.pop():new eo(i,o,d*p);return y.bi=v.bi=i,y.bj=v.bj=o,y.minForce=v.minForce=-d*p,y.maxForce=v.maxForce=d*p,y.ri.copy(t.ri),y.rj.copy(t.rj),v.ri.copy(t.ri),v.rj.copy(t.rj),t.ni.tangents(y.t,v.t),y.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,r.dt),v.setSpookParams(l.frictionEquationStiffness,l.frictionEquationRelaxation,r.dt),y.enabled=v.enabled=t.enabled,e.push(y,v),!0}return!1}createFrictionFromAverage(t){let e=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(e,this.frictionResult)||t===1)return;const i=this.frictionResult[this.frictionResult.length-2],o=this.frictionResult[this.frictionResult.length-1];Ot.setZero(),Ut.setZero(),$t.setZero();const s=e.bi;e.bj;for(let r=0;r!==t;r++)e=this.result[this.result.length-1-r],e.bi!==s?(Ot.vadd(e.ni,Ot),Ut.vadd(e.ri,Ut),$t.vadd(e.rj,$t)):(Ot.vsub(e.ni,Ot),Ut.vadd(e.rj,Ut),$t.vadd(e.ri,$t));const n=1/t;Ut.scale(n,i.ri),$t.scale(n,i.rj),o.ri.copy(i.ri),o.rj.copy(i.rj),Ot.normalize(),Ot.tangents(i.t,o.t)}getContacts(t,e,i,o,s,n,r){this.contactPointPool=s,this.frictionEquationPool=r,this.result=o,this.frictionResult=n;const l=pr,a=yr,c=dr,u=ur;for(let d=0,p=t.length;d!==p;d++){const m=t[d],y=e[d];let v=null;m.material&&y.material&&(v=i.getContactMaterial(m.material,y.material)||null);const g=m.type&L.KINEMATIC&&y.type&L.STATIC||m.type&L.STATIC&&y.type&L.KINEMATIC||m.type&L.KINEMATIC&&y.type&L.KINEMATIC;for(let f=0;f<m.shapes.length;f++){m.quaternion.mult(m.shapeOrientations[f],l),m.quaternion.vmult(m.shapeOffsets[f],c),c.vadd(m.position,c);const w=m.shapes[f];for(let S=0;S<y.shapes.length;S++){y.quaternion.mult(y.shapeOrientations[S],a),y.quaternion.vmult(y.shapeOffsets[S],u),u.vadd(y.position,u);const P=y.shapes[S];if(!(w.collisionFilterMask&P.collisionFilterGroup&&P.collisionFilterMask&w.collisionFilterGroup)||c.distanceTo(u)>w.boundingSphereRadius+P.boundingSphereRadius)continue;let B=null;w.material&&P.material&&(B=i.getContactMaterial(w.material,P.material)||null),this.currentContactMaterial=B||v||i.defaultContactMaterial;const k=w.type|P.type,T=this[k];if(T){let x=!1;w.type<P.type?x=T.call(this,w,P,c,u,l,a,m,y,w,P,g):x=T.call(this,P,w,u,c,a,l,y,m,w,P,g),x&&g&&(i.shapeOverlapKeeper.set(w.id,P.id),i.bodyOverlapKeeper.set(m.id,y.id))}}}}}sphereSphere(t,e,i,o,s,n,r,l,a,c,u){if(u)return i.distanceSquared(o)<(t.radius+e.radius)**2;const d=this.createContactEquation(r,l,t,e,a,c);o.vsub(i,d.ni),d.ni.normalize(),d.ri.copy(d.ni),d.rj.copy(d.ni),d.ri.scale(t.radius,d.ri),d.rj.scale(-e.radius,d.rj),d.ri.vadd(i,d.ri),d.ri.vsub(r.position,d.ri),d.rj.vadd(o,d.rj),d.rj.vsub(l.position,d.rj),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}spherePlane(t,e,i,o,s,n,r,l,a,c,u){const d=this.createContactEquation(r,l,t,e,a,c);if(d.ni.set(0,0,1),n.vmult(d.ni,d.ni),d.ni.negate(d.ni),d.ni.normalize(),d.ni.scale(t.radius,d.ri),i.vsub(o,Re),d.ni.scale(d.ni.dot(Re),io),Re.vsub(io,d.rj),-Re.dot(d.ni)<=t.radius){if(u)return!0;const p=d.ri,m=d.rj;p.vadd(i,p),p.vsub(r.position,p),m.vadd(o,m),m.vsub(l.position,m),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}}boxBox(t,e,i,o,s,n,r,l,a,c,u){return t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,i,o,s,n,r,l,t,e,u)}sphereBox(t,e,i,o,s,n,r,l,a,c,u){const d=this.v3pool,p=Wr;i.vsub(o,Ne),e.getSideNormals(p,n);const m=t.radius;let y=!1;const v=Gr,g=Vr,f=Hr;let w=null,S=0,P=0,B=0,k=null;for(let F=0,j=p.length;F!==j&&y===!1;F++){const _=Lr;_.copy(p[F]);const H=_.length();_.normalize();const ot=Ne.dot(_);if(ot<H+m&&ot>0){const Z=jr,D=Or;Z.copy(p[(F+1)%3]),D.copy(p[(F+2)%3]);const nt=Z.length(),mt=D.length();Z.normalize(),D.normalize();const wt=Ne.dot(Z),It=Ne.dot(D);if(wt<nt&&wt>-nt&&It<mt&&It>-mt){const Wt=Math.abs(ot-H-m);if((k===null||Wt<k)&&(k=Wt,P=wt,B=It,w=H,v.copy(_),g.copy(Z),f.copy(D),S++,u))return!0}}}if(S){y=!0;const F=this.createContactEquation(r,l,t,e,a,c);v.scale(-m,F.ri),F.ni.copy(v),F.ni.negate(F.ni),v.scale(w,v),g.scale(P,g),v.vadd(g,v),f.scale(B,f),v.vadd(f,F.rj),F.ri.vadd(i,F.ri),F.ri.vsub(r.position,F.ri),F.rj.vadd(o,F.rj),F.rj.vsub(l.position,F.rj),this.result.push(F),this.createFrictionEquationsFromContact(F,this.frictionResult)}let T=d.get();const x=Dr;for(let F=0;F!==2&&!y;F++)for(let j=0;j!==2&&!y;j++)for(let _=0;_!==2&&!y;_++)if(T.set(0,0,0),F?T.vadd(p[0],T):T.vsub(p[0],T),j?T.vadd(p[1],T):T.vsub(p[1],T),_?T.vadd(p[2],T):T.vsub(p[2],T),o.vadd(T,x),x.vsub(i,x),x.lengthSquared()<m*m){if(u)return!0;y=!0;const H=this.createContactEquation(r,l,t,e,a,c);H.ri.copy(x),H.ri.normalize(),H.ni.copy(H.ri),H.ri.scale(m,H.ri),H.rj.copy(T),H.ri.vadd(i,H.ri),H.ri.vsub(r.position,H.ri),H.rj.vadd(o,H.rj),H.rj.vsub(l.position,H.rj),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult)}d.release(T),T=null;const C=d.get(),I=d.get(),z=d.get(),b=d.get(),R=d.get(),M=p.length;for(let F=0;F!==M&&!y;F++)for(let j=0;j!==M&&!y;j++)if(F%3!==j%3){p[j].cross(p[F],C),C.normalize(),p[F].vadd(p[j],I),z.copy(i),z.vsub(I,z),z.vsub(o,z);const _=z.dot(C);C.scale(_,b);let H=0;for(;H===F%3||H===j%3;)H++;R.copy(i),R.vsub(b,R),R.vsub(I,R),R.vsub(o,R);const ot=Math.abs(_),Z=R.length();if(ot<p[H].length()&&Z<m){if(u)return!0;y=!0;const D=this.createContactEquation(r,l,t,e,a,c);I.vadd(b,D.rj),D.rj.copy(D.rj),R.negate(D.ni),D.ni.normalize(),D.ri.copy(D.rj),D.ri.vadd(o,D.ri),D.ri.vsub(i,D.ri),D.ri.normalize(),D.ri.scale(m,D.ri),D.ri.vadd(i,D.ri),D.ri.vsub(r.position,D.ri),D.rj.vadd(o,D.rj),D.rj.vsub(l.position,D.rj),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult)}}d.release(C,I,z,b,R)}planeBox(t,e,i,o,s,n,r,l,a,c,u){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,e.convexPolyhedronRepresentation.id=e.id,this.planeConvex(t,e.convexPolyhedronRepresentation,i,o,s,n,r,l,t,e,u)}convexConvex(t,e,i,o,s,n,r,l,a,c,u,d,p){const m=na;if(!(i.distanceTo(o)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,i,s,o,n,m,d,p)){const y=[],v=ra;t.clipAgainstHull(i,s,e,o,n,m,-100,100,y);let g=0;for(let f=0;f!==y.length;f++){if(u)return!0;const w=this.createContactEquation(r,l,t,e,a,c),S=w.ri,P=w.rj;m.negate(w.ni),y[f].normal.negate(v),v.scale(y[f].depth,v),y[f].point.vadd(v,S),P.copy(y[f].point),S.vsub(i,S),P.vsub(o,P),S.vadd(i,S),S.vsub(r.position,S),P.vadd(o,P),P.vsub(l.position,P),this.result.push(w),g++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(w,this.frictionResult)}this.enableFrictionReduction&&g&&this.createFrictionFromAverage(g)}}sphereConvex(t,e,i,o,s,n,r,l,a,c,u){const d=this.v3pool;i.vsub(o,Yr);const p=e.faceNormals,m=e.faces,y=e.vertices,v=t.radius;let g=!1;for(let f=0;f!==y.length;f++){const w=y[f],S=$r;n.vmult(w,S),o.vadd(S,S);const P=Ur;if(S.vsub(i,P),P.lengthSquared()<v*v){if(u)return!0;g=!0;const B=this.createContactEquation(r,l,t,e,a,c);B.ri.copy(P),B.ri.normalize(),B.ni.copy(B.ri),B.ri.scale(v,B.ri),S.vsub(o,B.rj),B.ri.vadd(i,B.ri),B.ri.vsub(r.position,B.ri),B.rj.vadd(o,B.rj),B.rj.vsub(l.position,B.rj),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult);return}}for(let f=0,w=m.length;f!==w&&g===!1;f++){const S=p[f],P=m[f],B=Kr;n.vmult(S,B);const k=Zr;n.vmult(y[P[0]],k),k.vadd(o,k);const T=Qr;B.scale(-v,T),i.vadd(T,T);const x=Jr;T.vsub(k,x);const C=x.dot(B),I=ta;if(i.vsub(k,I),C<0&&I.dot(B)>0){const z=[];for(let b=0,R=P.length;b!==R;b++){const M=d.get();n.vmult(y[P[b]],M),o.vadd(M,M),z.push(M)}if(qr(z,B,i)){if(u)return!0;g=!0;const b=this.createContactEquation(r,l,t,e,a,c);B.scale(-v,b.ri),B.negate(b.ni);const R=d.get();B.scale(-C,R);const M=d.get();B.scale(-v,M),i.vsub(o,b.rj),b.rj.vadd(M,b.rj),b.rj.vadd(R,b.rj),b.rj.vadd(o,b.rj),b.rj.vsub(l.position,b.rj),b.ri.vadd(i,b.ri),b.ri.vsub(r.position,b.ri),d.release(R),d.release(M),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult);for(let F=0,j=z.length;F!==j;F++)d.release(z[F]);return}else for(let b=0;b!==P.length;b++){const R=d.get(),M=d.get();n.vmult(y[P[(b+1)%P.length]],R),n.vmult(y[P[(b+2)%P.length]],M),o.vadd(R,R),o.vadd(M,M);const F=_r;M.vsub(R,F);const j=Xr;F.unit(j);const _=d.get(),H=d.get();i.vsub(R,H);const ot=H.dot(j);j.scale(ot,_),_.vadd(R,_);const Z=d.get();if(_.vsub(i,Z),ot>0&&ot*ot<F.lengthSquared()&&Z.lengthSquared()<v*v){if(u)return!0;const D=this.createContactEquation(r,l,t,e,a,c);_.vsub(o,D.rj),_.vsub(i,D.ni),D.ni.normalize(),D.ni.scale(v,D.ri),D.rj.vadd(o,D.rj),D.rj.vsub(l.position,D.rj),D.ri.vadd(i,D.ri),D.ri.vsub(r.position,D.ri),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult);for(let nt=0,mt=z.length;nt!==mt;nt++)d.release(z[nt]);d.release(R),d.release(M),d.release(_),d.release(Z),d.release(H);return}d.release(R),d.release(M),d.release(_),d.release(Z),d.release(H)}for(let b=0,R=z.length;b!==R;b++)d.release(z[b])}}}planeConvex(t,e,i,o,s,n,r,l,a,c,u){const d=ea,p=ia;p.set(0,0,1),s.vmult(p,p);let m=0;const y=oa;for(let v=0;v!==e.vertices.length;v++)if(d.copy(e.vertices[v]),n.vmult(d,d),o.vadd(d,d),d.vsub(i,y),p.dot(y)<=0){if(u)return!0;const g=this.createContactEquation(r,l,t,e,a,c),f=sa;p.scale(p.dot(y),f),d.vsub(f,f),f.vsub(i,g.ri),g.ni.copy(p),d.vsub(o,g.rj),g.ri.vadd(i,g.ri),g.ri.vsub(r.position,g.ri),g.rj.vadd(o,g.rj),g.rj.vsub(l.position,g.rj),this.result.push(g),m++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(g,this.frictionResult)}this.enableFrictionReduction&&m&&this.createFrictionFromAverage(m)}boxConvex(t,e,i,o,s,n,r,l,a,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,i,o,s,n,r,l,t,e,u)}sphereHeightfield(t,e,i,o,s,n,r,l,a,c,u){const d=e.data,p=t.radius,m=e.elementSize,y=ga,v=fa;X.pointToLocalFrame(o,n,i,v);let g=Math.floor((v.x-p)/m)-1,f=Math.ceil((v.x+p)/m)+1,w=Math.floor((v.y-p)/m)-1,S=Math.ceil((v.y+p)/m)+1;if(f<0||S<0||g>d.length||w>d[0].length)return;g<0&&(g=0),f<0&&(f=0),w<0&&(w=0),S<0&&(S=0),g>=d.length&&(g=d.length-1),f>=d.length&&(f=d.length-1),S>=d[0].length&&(S=d[0].length-1),w>=d[0].length&&(w=d[0].length-1);const P=[];e.getRectMinMax(g,w,f,S,P);const B=P[0],k=P[1];if(v.z-p>k||v.z+p<B)return;const T=this.result;for(let x=g;x<f;x++)for(let C=w;C<S;C++){const I=T.length;let z=!1;if(e.getConvexTrianglePillar(x,C,!1),X.pointToWorldFrame(o,n,e.pillarOffset,y),i.distanceTo(y)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(z=this.sphereConvex(t,e.pillarConvex,i,y,s,n,r,l,t,e,u)),u&&z||(e.getConvexTrianglePillar(x,C,!0),X.pointToWorldFrame(o,n,e.pillarOffset,y),i.distanceTo(y)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(z=this.sphereConvex(t,e.pillarConvex,i,y,s,n,r,l,t,e,u)),u&&z))return!0;if(T.length-I>2)return}}boxHeightfield(t,e,i,o,s,n,r,l,a,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,i,o,s,n,r,l,t,e,u)}convexHeightfield(t,e,i,o,s,n,r,l,a,c,u){const d=e.data,p=e.elementSize,m=t.boundingSphereRadius,y=ma,v=va,g=ya;X.pointToLocalFrame(o,n,i,g);let f=Math.floor((g.x-m)/p)-1,w=Math.ceil((g.x+m)/p)+1,S=Math.floor((g.y-m)/p)-1,P=Math.ceil((g.y+m)/p)+1;if(w<0||P<0||f>d.length||S>d[0].length)return;f<0&&(f=0),w<0&&(w=0),S<0&&(S=0),P<0&&(P=0),f>=d.length&&(f=d.length-1),w>=d.length&&(w=d.length-1),P>=d[0].length&&(P=d[0].length-1),S>=d[0].length&&(S=d[0].length-1);const B=[];e.getRectMinMax(f,S,w,P,B);const k=B[0],T=B[1];if(!(g.z-m>T||g.z+m<k))for(let x=f;x<w;x++)for(let C=S;C<P;C++){let I=!1;if(e.getConvexTrianglePillar(x,C,!1),X.pointToWorldFrame(o,n,e.pillarOffset,y),i.distanceTo(y)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(I=this.convexConvex(t,e.pillarConvex,i,y,s,n,r,l,null,null,u,v,null)),u&&I||(e.getConvexTrianglePillar(x,C,!0),X.pointToWorldFrame(o,n,e.pillarOffset,y),i.distanceTo(y)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&(I=this.convexConvex(t,e.pillarConvex,i,y,s,n,r,l,null,null,u,v,null)),u&&I))return!0}}sphereParticle(t,e,i,o,s,n,r,l,a,c,u){const d=ha;if(d.set(0,0,1),o.vsub(i,d),d.lengthSquared()<=t.radius*t.radius){if(u)return!0;const p=this.createContactEquation(l,r,e,t,a,c);d.normalize(),p.rj.copy(d),p.rj.scale(t.radius,p.rj),p.ni.copy(d),p.ni.negate(p.ni),p.ri.set(0,0,0),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}}planeParticle(t,e,i,o,s,n,r,l,a,c,u){const d=aa;d.set(0,0,1),r.quaternion.vmult(d,d);const p=la;if(o.vsub(r.position,p),d.dot(p)<=0){if(u)return!0;const m=this.createContactEquation(l,r,e,t,a,c);m.ni.copy(d),m.ni.negate(m.ni),m.ri.set(0,0,0);const y=ca;d.scale(d.dot(o),y),o.vsub(y,y),m.rj.copy(y),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}boxParticle(t,e,i,o,s,n,r,l,a,c,u){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,i,o,s,n,r,l,t,e,u)}convexParticle(t,e,i,o,s,n,r,l,a,c,u){let d=-1;const p=ua,m=pa;let y=null;const v=da;if(v.copy(o),v.vsub(i,v),s.conjugate(oo),oo.vmult(v,v),t.pointIsInside(v)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(i,s),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(s);for(let g=0,f=t.faces.length;g!==f;g++){const w=[t.worldVertices[t.faces[g][0]]],S=t.worldFaceNormals[g];o.vsub(w[0],so);const P=-S.dot(so);if(y===null||Math.abs(P)<Math.abs(y)){if(u)return!0;y=P,d=g,p.copy(S)}}if(d!==-1){const g=this.createContactEquation(l,r,e,t,a,c);p.scale(y,m),m.vadd(o,m),m.vsub(i,m),g.rj.copy(m),p.negate(g.ni),g.ri.set(0,0,0);const f=g.ri,w=g.rj;f.vadd(o,f),f.vsub(l.position,f),w.vadd(i,w),w.vsub(r.position,w),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(t,e,i,o,s,n,r,l,a,c,u){return this.convexHeightfield(e,t,o,i,n,s,l,r,a,c,u)}particleCylinder(t,e,i,o,s,n,r,l,a,c,u){return this.convexParticle(e,t,o,i,n,s,l,r,a,c,u)}sphereTrimesh(t,e,i,o,s,n,r,l,a,c,u){const d=Er,p=Sr,m=zr,y=Cr,v=Ar,g=Tr,f=Fr,w=br,S=wr,P=Rr;X.pointToLocalFrame(o,n,i,v);const B=t.radius;f.lowerBound.set(v.x-B,v.y-B,v.z-B),f.upperBound.set(v.x+B,v.y+B,v.z+B),e.getTrianglesInAABB(f,P);const k=xr,T=t.radius*t.radius;for(let b=0;b<P.length;b++)for(let R=0;R<3;R++)if(e.getVertex(e.indices[P[b]*3+R],k),k.vsub(v,S),S.lengthSquared()<=T){if(w.copy(k),X.pointToWorldFrame(o,n,w,k),k.vsub(i,S),u)return!0;let M=this.createContactEquation(r,l,t,e,a,c);M.ni.copy(S),M.ni.normalize(),M.ri.copy(M.ni),M.ri.scale(t.radius,M.ri),M.ri.vadd(i,M.ri),M.ri.vsub(r.position,M.ri),M.rj.copy(k),M.rj.vsub(l.position,M.rj),this.result.push(M),this.createFrictionEquationsFromContact(M,this.frictionResult)}for(let b=0;b<P.length;b++)for(let R=0;R<3;R++){e.getVertex(e.indices[P[b]*3+R],d),e.getVertex(e.indices[P[b]*3+(R+1)%3],p),p.vsub(d,m),v.vsub(p,g);const M=g.dot(m);v.vsub(d,g);let F=g.dot(m);if(F>0&&M<0&&(v.vsub(d,g),y.copy(m),y.normalize(),F=g.dot(y),y.scale(F,g),g.vadd(d,g),g.distanceTo(v)<t.radius)){if(u)return!0;const j=this.createContactEquation(r,l,t,e,a,c);g.vsub(v,j.ni),j.ni.normalize(),j.ni.scale(t.radius,j.ri),j.ri.vadd(i,j.ri),j.ri.vsub(r.position,j.ri),X.pointToWorldFrame(o,n,g,g),g.vsub(l.position,j.rj),X.vectorToWorldFrame(n,j.ni,j.ni),X.vectorToWorldFrame(n,j.ri,j.ri),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}}const x=Pr,C=Mr,I=Br,z=gr;for(let b=0,R=P.length;b!==R;b++){e.getTriangleVertices(P[b],x,C,I),e.getNormal(P[b],z),v.vsub(x,g);let M=g.dot(z);if(z.scale(M,g),v.vsub(g,g),M=g.distanceTo(v),it.pointInTriangle(g,x,C,I)&&M<t.radius){if(u)return!0;let F=this.createContactEquation(r,l,t,e,a,c);g.vsub(v,F.ni),F.ni.normalize(),F.ni.scale(t.radius,F.ri),F.ri.vadd(i,F.ri),F.ri.vsub(r.position,F.ri),X.pointToWorldFrame(o,n,g,g),g.vsub(l.position,F.rj),X.vectorToWorldFrame(n,F.ni,F.ni),X.vectorToWorldFrame(n,F.ri,F.ri),this.result.push(F),this.createFrictionEquationsFromContact(F,this.frictionResult)}}P.length=0}planeTrimesh(t,e,i,o,s,n,r,l,a,c,u){const d=new h,p=mr;p.set(0,0,1),s.vmult(p,p);for(let m=0;m<e.vertices.length/3;m++){e.getVertex(m,d);const y=new h;y.copy(d),X.pointToWorldFrame(o,n,y,d);const v=vr;if(d.vsub(i,v),p.dot(v)<=0){if(u)return!0;const g=this.createContactEquation(r,l,t,e,a,c);g.ni.copy(p);const f=fr;p.scale(v.dot(p),f),d.vsub(f,f),g.ri.copy(f),g.ri.vsub(r.position,g.ri),g.rj.copy(d),g.rj.vsub(l.position,g.rj),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}}}}const Ot=new h,Ut=new h,$t=new h,dr=new h,ur=new h,pr=new tt,yr=new tt,mr=new h,vr=new h,fr=new h,gr=new h,wr=new h;new h;const xr=new h,br=new h,Er=new h,Sr=new h,zr=new h,Cr=new h,Ar=new h,Tr=new h,Pr=new h,Mr=new h,Br=new h,Fr=new ut,Rr=[],Re=new h,io=new h,Nr=new h,Ir=new h,kr=new h;function qr(E,t,e){let i=null;const o=E.length;for(let s=0;s!==o;s++){const n=E[s],r=Nr;E[(s+1)%o].vsub(n,r);const l=Ir;r.cross(t,l);const a=kr;e.vsub(n,a);const c=l.dot(a);if(i===null||c>0&&i===!0||c<=0&&i===!1){i===null&&(i=c>0);continue}else return!1}return!0}const Ne=new h,Lr=new h,jr=new h,Or=new h,Wr=[new h,new h,new h,new h,new h,new h],Dr=new h,Gr=new h,Vr=new h,Hr=new h,Yr=new h,_r=new h,Xr=new h,Ur=new h,$r=new h,Kr=new h,Zr=new h,Qr=new h,Jr=new h,ta=new h;new h,new h;const ea=new h,ia=new h,oa=new h,sa=new h,na=new h,ra=new h,aa=new h,la=new h,ca=new h,ha=new h,oo=new tt,da=new h;new h;const ua=new h,so=new h,pa=new h,ya=new h,ma=new h,va=[0],fa=new h,ga=new h;class no{constructor(){this.current=[],this.previous=[]}getKey(t,e){if(e<t){const i=e;e=t,t=i}return t<<16|e}set(t,e){const i=this.getKey(t,e),o=this.current;let s=0;for(;i>o[s];)s++;if(i!==o[s]){for(let n=o.length-1;n>=s;n--)o[n+1]=o[n];o[s]=i}}tick(){const t=this.current;this.current=this.previous,this.previous=t,this.current.length=0}getDiff(t,e){const i=this.current,o=this.previous,s=i.length,n=o.length;let r=0;for(let l=0;l<s;l++){let a=!1;const c=i[l];for(;c>o[r];)r++;a=c===o[r],a||ro(t,c)}r=0;for(let l=0;l<n;l++){let a=!1;const c=o[l];for(;c>i[r];)r++;a=i[r]===c,a||ro(e,c)}}}function ro(E,t){E.push((t&4294901760)>>16,t&65535)}const oi=(E,t)=>E<t?`${E}-${t}`:`${t}-${E}`;class wa{constructor(){this.data={keys:[]}}get(t,e){const i=oi(t,e);return this.data[i]}set(t,e,i){const o=oi(t,e);this.get(t,e)||this.data.keys.push(o),this.data[o]=i}delete(t,e){const i=oi(t,e),o=this.data.keys.indexOf(i);o!==-1&&this.data.keys.splice(o,1),delete this.data[i]}reset(){const t=this.data,e=t.keys;for(;e.length>0;){const i=e.pop();delete t[i]}}}class xa extends ji{constructor(t){t===void 0&&(t={}),super(),this.dt=-1,this.allowSleep=!!t.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=t.quatNormalizeSkip!==void 0?t.quatNormalizeSkip:0,this.quatNormalizeFast=t.quatNormalizeFast!==void 0?t.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new h,t.gravity&&this.gravity.copy(t.gravity),t.frictionGravity&&(this.frictionGravity=new h,this.frictionGravity.copy(t.frictionGravity)),this.broadphase=t.broadphase!==void 0?t.broadphase:new Tn,this.bodies=[],this.hasActiveBodies=!1,this.solver=t.solver!==void 0?t.solver:new sr,this.constraints=[],this.narrowphase=new hr(this),this.collisionMatrix=new Li,this.collisionMatrixPrevious=new Li,this.bodyOverlapKeeper=new no,this.shapeOverlapKeeper=new no,this.contactmaterials=[],this.contactMaterialTable=new wa,this.defaultMaterial=new Be("default"),this.defaultContactMaterial=new Me(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(t,e){return this.contactMaterialTable.get(t.id,e.id)}collisionMatrixTick(){const t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(t){this.constraints.push(t)}removeConstraint(t){const e=this.constraints.indexOf(t);e!==-1&&this.constraints.splice(e,1)}rayTest(t,e,i){i instanceof Ce?this.raycastClosest(t,e,{skipBackfaces:!0},i):this.raycastAll(t,e,{skipBackfaces:!0},i)}raycastAll(t,e,i,o){return i===void 0&&(i={}),i.mode=it.ALL,i.from=t,i.to=e,i.callback=o,si.intersectWorld(this,i)}raycastAny(t,e,i,o){return i===void 0&&(i={}),i.mode=it.ANY,i.from=t,i.to=e,i.result=o,si.intersectWorld(this,i)}raycastClosest(t,e,i,o){return i===void 0&&(i={}),i.mode=it.CLOSEST,i.from=t,i.to=e,i.result=o,si.intersectWorld(this,i)}addBody(t){this.bodies.includes(t)||(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof L&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.idToBodyMap[t.id]=t,this.dispatchEvent(this.addBodyEvent))}removeBody(t){t.world=null;const e=this.bodies.length-1,i=this.bodies,o=i.indexOf(t);if(o!==-1){i.splice(o,1);for(let s=0;s!==i.length;s++)i[s].index=s;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,delete this.idToBodyMap[t.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(t){return this.idToBodyMap[t]}getShapeById(t){const e=this.bodies;for(let i=0;i<e.length;i++){const o=e[i].shapes;for(let s=0;s<o.length;s++){const n=o[s];if(n.id===t)return n}}return null}addContactMaterial(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)}removeContactMaterial(t){const e=this.contactmaterials.indexOf(t);e!==-1&&(this.contactmaterials.splice(e,1),this.contactMaterialTable.delete(t.materials[0].id,t.materials[1].id))}fixedStep(t,e){t===void 0&&(t=1/60),e===void 0&&(e=10);const i=st.now()/1e3;if(!this.lastCallTime)this.step(t,void 0,e);else{const o=i-this.lastCallTime;this.step(t,o,e)}this.lastCallTime=i}step(t,e,i){if(i===void 0&&(i=10),e===void 0)this.internalStep(t),this.time+=t;else{this.accumulator+=e;const o=st.now();let s=0;for(;this.accumulator>=t&&s<i&&(this.internalStep(t),this.accumulator-=t,s++,!(st.now()-o>t*1e3)););this.accumulator=this.accumulator%t;const n=this.accumulator/t;for(let r=0;r!==this.bodies.length;r++){const l=this.bodies[r];l.previousPosition.lerp(l.position,n,l.interpolatedPosition),l.previousQuaternion.slerp(l.quaternion,n,l.interpolatedQuaternion),l.previousQuaternion.normalize()}this.time+=e}}internalStep(t){this.dt=t;const e=this.contacts,i=Ca,o=Aa,s=this.bodies.length,n=this.bodies,r=this.solver,l=this.gravity,a=this.doProfiling,c=this.profile,u=L.DYNAMIC;let d=-1/0;const p=this.constraints,m=za;l.length();const y=l.x,v=l.y,g=l.z;let f=0;for(a&&(d=st.now()),f=0;f!==s;f++){const z=n[f];if(z.type===u){const b=z.force,R=z.mass;b.x+=R*y,b.y+=R*v,b.z+=R*g}}for(let z=0,b=this.subsystems.length;z!==b;z++)this.subsystems[z].update();a&&(d=st.now()),i.length=0,o.length=0,this.broadphase.collisionPairs(this,i,o),a&&(c.broadphase=st.now()-d);let w=p.length;for(f=0;f!==w;f++){const z=p[f];if(!z.collideConnected)for(let b=i.length-1;b>=0;b-=1)(z.bodyA===i[b]&&z.bodyB===o[b]||z.bodyB===i[b]&&z.bodyA===o[b])&&(i.splice(b,1),o.splice(b,1))}this.collisionMatrixTick(),a&&(d=st.now());const S=Sa,P=e.length;for(f=0;f!==P;f++)S.push(e[f]);e.length=0;const B=this.frictionEquations.length;for(f=0;f!==B;f++)m.push(this.frictionEquations[f]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,o,this,e,S,this.frictionEquations,m),a&&(c.narrowphase=st.now()-d),a&&(d=st.now()),f=0;f<this.frictionEquations.length;f++)r.addEquation(this.frictionEquations[f]);const k=e.length;for(let z=0;z!==k;z++){const b=e[z],R=b.bi,M=b.bj,F=b.si,j=b.sj;let _;if(R.material&&M.material?_=this.getContactMaterial(R.material,M.material)||this.defaultContactMaterial:_=this.defaultContactMaterial,_.friction,R.material&&M.material&&(R.material.friction>=0&&M.material.friction>=0&&R.material.friction*M.material.friction,R.material.restitution>=0&&M.material.restitution>=0&&(b.restitution=R.material.restitution*M.material.restitution)),r.addEquation(b),R.allowSleep&&R.type===L.DYNAMIC&&R.sleepState===L.SLEEPING&&M.sleepState===L.AWAKE&&M.type!==L.STATIC){const H=M.velocity.lengthSquared()+M.angularVelocity.lengthSquared(),ot=M.sleepSpeedLimit**2;H>=ot*2&&(R.wakeUpAfterNarrowphase=!0)}if(M.allowSleep&&M.type===L.DYNAMIC&&M.sleepState===L.SLEEPING&&R.sleepState===L.AWAKE&&R.type!==L.STATIC){const H=R.velocity.lengthSquared()+R.angularVelocity.lengthSquared(),ot=R.sleepSpeedLimit**2;H>=ot*2&&(M.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(R,M,!0),this.collisionMatrixPrevious.get(R,M)||(re.body=M,re.contact=b,R.dispatchEvent(re),re.body=R,M.dispatchEvent(re)),this.bodyOverlapKeeper.set(R.id,M.id),this.shapeOverlapKeeper.set(F.id,j.id)}for(this.emitContactEvents(),a&&(c.makeContactConstraints=st.now()-d,d=st.now()),f=0;f!==s;f++){const z=n[f];z.wakeUpAfterNarrowphase&&(z.wakeUp(),z.wakeUpAfterNarrowphase=!1)}for(w=p.length,f=0;f!==w;f++){const z=p[f];z.update();for(let b=0,R=z.equations.length;b!==R;b++){const M=z.equations[b];r.addEquation(M)}}r.solve(t,this),a&&(c.solve=st.now()-d),r.removeAllEquations();const T=Math.pow;for(f=0;f!==s;f++){const z=n[f];if(z.type&u){const b=T(1-z.linearDamping,t),R=z.velocity;R.scale(b,R);const M=z.angularVelocity;if(M){const F=T(1-z.angularDamping,t);M.scale(F,M)}}}this.dispatchEvent(Ea),a&&(d=st.now());const x=this.stepnumber%(this.quatNormalizeSkip+1)===0,C=this.quatNormalizeFast;for(f=0;f!==s;f++)n[f].integrate(t,x,C);this.clearForces(),this.broadphase.dirty=!0,a&&(c.integrate=st.now()-d),this.stepnumber+=1,this.dispatchEvent(ba);let I=!0;if(this.allowSleep)for(I=!1,f=0;f!==s;f++){const z=n[f];z.sleepTick(this.time),z.sleepState!==L.SLEEPING&&(I=!0)}this.hasActiveBodies=I}emitContactEvents(){const t=this.hasAnyEventListener("beginContact"),e=this.hasAnyEventListener("endContact");if((t||e)&&this.bodyOverlapKeeper.getDiff(Ct,At),t){for(let s=0,n=Ct.length;s<n;s+=2)ae.bodyA=this.getBodyById(Ct[s]),ae.bodyB=this.getBodyById(Ct[s+1]),this.dispatchEvent(ae);ae.bodyA=ae.bodyB=null}if(e){for(let s=0,n=At.length;s<n;s+=2)le.bodyA=this.getBodyById(At[s]),le.bodyB=this.getBodyById(At[s+1]),this.dispatchEvent(le);le.bodyA=le.bodyB=null}Ct.length=At.length=0;const i=this.hasAnyEventListener("beginShapeContact"),o=this.hasAnyEventListener("endShapeContact");if((i||o)&&this.shapeOverlapKeeper.getDiff(Ct,At),i){for(let s=0,n=Ct.length;s<n;s+=2){const r=this.getShapeById(Ct[s]),l=this.getShapeById(Ct[s+1]);Tt.shapeA=r,Tt.shapeB=l,r&&(Tt.bodyA=r.body),l&&(Tt.bodyB=l.body),this.dispatchEvent(Tt)}Tt.bodyA=Tt.bodyB=Tt.shapeA=Tt.shapeB=null}if(o){for(let s=0,n=At.length;s<n;s+=2){const r=this.getShapeById(At[s]),l=this.getShapeById(At[s+1]);Pt.shapeA=r,Pt.shapeB=l,r&&(Pt.bodyA=r.body),l&&(Pt.bodyB=l.body),this.dispatchEvent(Pt)}Pt.bodyA=Pt.bodyB=Pt.shapeA=Pt.shapeB=null}}clearForces(){const t=this.bodies,e=t.length;for(let i=0;i!==e;i++){const o=t[i];o.force,o.torque,o.force.set(0,0,0),o.torque.set(0,0,0)}}}new ut;const si=new it,st=globalThis.performance||{};if(!st.now){let E=Date.now();st.timing&&st.timing.navigationStart&&(E=st.timing.navigationStart),st.now=()=>Date.now()-E}new h;const ba={type:"postStep"},Ea={type:"preStep"},re={type:L.COLLIDE_EVENT_NAME,body:null,contact:null},Sa=[],za=[],Ca=[],Aa=[],Ct=[],At=[],ae={type:"beginContact",bodyA:null,bodyB:null},le={type:"endContact",bodyA:null,bodyB:null},Tt={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Pt={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var ce=function(){var E=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(c){c.preventDefault(),i(++E%t.children.length)},!1);function e(c){return t.appendChild(c.dom),c}function i(c){for(var u=0;u<t.children.length;u++)t.children[u].style.display=u===c?"block":"none";E=c}var o=(performance||Date).now(),s=o,n=0,r=e(new ce.Panel("FPS","#0ff","#002")),l=e(new ce.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var a=e(new ce.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:e,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){n++;var c=(performance||Date).now();if(l.update(c-o,200),c>=s+1e3&&(r.update(n*1e3/(c-s),100),s=c,n=0,a)){var u=performance.memory;a.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return c},update:function(){o=this.end()},domElement:t,setMode:i}};ce.Panel=function(E,t,e){var i=1/0,o=0,s=Math.round,n=s(window.devicePixelRatio||1),r=80*n,l=48*n,a=3*n,c=2*n,u=3*n,d=15*n,p=74*n,m=30*n,y=document.createElement("canvas");y.width=r,y.height=l,y.style.cssText="width:80px;height:48px";var v=y.getContext("2d");return v.font="bold "+9*n+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=e,v.fillRect(0,0,r,l),v.fillStyle=t,v.fillText(E,a,c),v.fillRect(u,d,p,m),v.fillStyle=e,v.globalAlpha=.9,v.fillRect(u,d,p,m),{dom:y,update:function(g,f){i=Math.min(i,g),o=Math.max(o,g),v.fillStyle=e,v.globalAlpha=1,v.fillRect(0,0,r,d),v.fillStyle=t,v.fillText(s(g)+" "+E+" ("+s(i)+"-"+s(o)+")",a,c),v.drawImage(y,u+n,d,p-n,m,u,d,p-n,m),v.fillRect(u+p-n,d,n,m),v.fillStyle=e,v.globalAlpha=.9,v.fillRect(u+p-n,d,n,s((1-g/f)*m))}}};function Ta(E,t,e){let{color:i=65280,scale:o=1,onInit:s,onUpdate:n}=e===void 0?{}:e;const r=[],l=new Zt({color:i??65280,wireframe:!0}),a=new h,c=new h,u=new h,d=new tt,p=new ve(1),m=new Fs(1,1,1),y=new vi(10,10,10,10);y.translate(0,0,1e-4);function v(T){const x=new fi,C=[];for(let z=0;z<T.vertices.length;z++){const b=T.vertices[z];C.push(b.x,b.y,b.z)}x.setAttribute("position",new gi(C,3));const I=[];for(let z=0;z<T.faces.length;z++){const b=T.faces[z],R=b[0];for(let M=1;M<b.length-1;M++){const F=b[M],j=b[M+1];I.push(R,F,j)}}return x.setIndex(I),x.computeBoundingSphere(),x.computeVertexNormals(),x}function g(T){const x=new fi,C=[],I=a,z=c,b=u;for(let R=0;R<T.indices.length/3;R++)T.getTriangleVertices(R,I,z,b),C.push(I.x,I.y,I.z),C.push(z.x,z.y,z.z),C.push(b.x,b.y,b.z);return x.setAttribute("position",new gi(C,3)),x.computeBoundingSphere(),x.computeVertexNormals(),x}function f(T){const x=new fi,C=T.elementSize||1,I=T.data.flatMap((b,R)=>b.flatMap((M,F)=>[R*C,F*C,M])),z=[];for(let b=0;b<T.data.length-1;b++)for(let R=0;R<T.data[b].length-1;R++){const M=T.data[b].length,F=b*M+R;z.push(F+1,F+M,F+M+1),z.push(F+M,F+1,F)}return x.setIndex(z),x.setAttribute("position",new gi(I,3)),x.computeBoundingSphere(),x.computeVertexNormals(),x}function w(T){let x=new dt;const{SPHERE:C,BOX:I,PLANE:z,CYLINDER:b,CONVEXPOLYHEDRON:R,TRIMESH:M,HEIGHTFIELD:F}=q.types;switch(T.type){case C:{x=new dt(p,l);break}case I:{x=new dt(m,l);break}case z:{x=new dt(y,l);break}case b:{const j=new Qa(T.radiusTop,T.radiusBottom,T.height,T.numSegments);x=new dt(j,l),T.geometryId=j.id;break}case R:{const j=v(T);x=new dt(j,l),T.geometryId=j.id;break}case M:{const j=g(T);x=new dt(j,l),T.geometryId=j.id;break}case F:{const j=f(T);x=new dt(j,l),T.geometryId=j.id;break}}return E.add(x),x}function S(T,x){const{SPHERE:C,BOX:I,PLANE:z,CYLINDER:b,CONVEXPOLYHEDRON:R,TRIMESH:M,HEIGHTFIELD:F}=q.types;switch(x.type){case C:{const{radius:j}=x;T.scale.set(j*o,j*o,j*o);break}case I:{T.scale.copy(x.halfExtents),T.scale.multiplyScalar(2*o);break}case z:break;case b:{T.scale.set(1*o,1*o,1*o);break}case R:{T.scale.set(1*o,1*o,1*o);break}case M:{T.scale.copy(x.scale).multiplyScalar(o);break}case F:{T.scale.set(1*o,1*o,1*o);break}}}function P(T,x){if(!T)return!1;const{geometry:C}=T;return C instanceof ve&&x.type===q.types.SPHERE||C instanceof Fs&&x.type===q.types.BOX||C instanceof vi&&x.type===q.types.PLANE||C.id===x.geometryId&&x.type===q.types.CYLINDER||C.id===x.geometryId&&x.type===q.types.CONVEXPOLYHEDRON||C.id===x.geometryId&&x.type===q.types.TRIMESH||C.id===x.geometryId&&x.type===q.types.HEIGHTFIELD}function B(T,x){let C=r[T],I=!1;return P(C,x)||(C&&E.remove(C),r[T]=C=w(x),I=!0),S(C,x),I}function k(){const T=r,x=a,C=d;let I=0;for(const z of t.bodies)for(let b=0;b!==z.shapes.length;b++){const R=z.shapes[b],M=B(I,R),F=T[I];F&&(z.quaternion.vmult(z.shapeOffsets[b],x),z.position.vadd(x,x),z.quaternion.mult(z.shapeOrientations[b],C),F.position.copy(x),F.quaternion.copy(C),M&&s instanceof Function&&s(z,F,R),!M&&n instanceof Function&&n(z,F,R)),I++}for(let z=I;z<T.length;z++){const b=T[z];b&&E.remove(b)}T.length=I}return{update:k}}let ao,lo,co,ho,uo,po,yo,mo,vo,fo,go,wo,ni,xo,bo,Eo,So,zo,Co,Ao,To,Po,Mo,Bo,Fo,Ro,No,Io,ko,qo,Lo,jo,Oo,Wo,Do,Go,Vo,Ho,Yo,_o,Xo,Uo,$o,Ko,Zo,Qo,Jo,ts,es,is,os;ao=40,lo={__name:"homeScene",setup(E){Ja();const{isDesktop:t,isMobile:e}=wi();V.registerPlugin(De),V.registerPlugin(ze,$e);const i=fe(),o=new tl,s=new el,n=new il;n.setDecoderPath("/models/"),s.setDRACOLoader(n);const r=new Sl,l=r.addFolder("Glass Material"),a=r.addFolder("Glass Material 2");r.addFolder("Glass Material 3");const c=V.context(()=>{}),u=V.context(()=>{});let d=new xa;d.solver.iterations=5,d.allowSleep=!0;let p=[],m,y,v,g,f,w,S,P,B,k,T,x,C,I,z,b,R,M,F,j,_,H,ot,Z,D,nt,mt,wt,It,Wt,Ie,Y,rt=new yl;const ss=[];let ri=[];const ns=[];let ke,rs;new ce;let Mt=[],he,as,ls,Dt,cs,de=new ol,Gt=new sl,Vt=20,Kt=!1,ue,ai,qe,hs,li,Le,ds,us;const ps=[];let ht=new h(0,0,0),ys=!1,ci=[],hi=!1,ms=[],di=!0,vs=!1,fs=[],ui=[],je=.5,gs=!1,Pa=V.timeline(),ws={value:15};const xs=et(null),pi=et(null),Bt=et(null);i.$onAction(({name:N,args:A})=>{if(N==="setJelMaterialOpacity"&&i.getPreloaderDone&&z&&(z.opacity=A[0]),N==="setJelMaterialReflectivity"&&i.getPreloaderDone&&x&&(x.reflectivity=A[0]),N==="setJelColor"&&(u.revert(),x.color=new at(A[0]).convertLinearToSRGB()),N==="setJelColor2"&&(u.revert(),z.color=new at(A[0]).convertLinearToSRGB()),N==="toggleSound"&&bs(A[0]),N==="showScene"&&(i.getSoundOn&&bs(!0),setTimeout(()=>{Ma(!0)},2e3),c.add(()=>{V.to(xs.value,{duration:.5,delay:je,opacity:1})}),Kt=!0,c.add(()=>{V.to(ke.scale,{x:1,y:1,z:1,duration:2,delay:je,ease:"power2.inOut"}),V.to(f.position,{z:qe.z,y:qe.y,x:qe.x,duration:2,delay:je,ease:"power2.inOut",onComplete:()=>{vs=!0,i.setSceneStartingPosition(),di=!1,window.addEventListener("mousemove",Ss,!1),ui.forEach(G=>{G.visible=!0}),fs.forEach(G=>{G.visible=!0})}})})),N==="updateScrollVelocity"){let G=A[0];G<0&&(G=-G),li.timeScale=1+G/800}if(N==="updateProgress"&&Le.progress(A[0]),N==="startProgress"&&(hi=!0,Mt.forEach(({body:G})=>{pe(G,5)}),c.add(()=>{V.to(he.shapes[0],{radius:1,duration:1,ease:"power2.out"})}),d.gravity.set(0,.2,0),Vt=-20),N==="stopProgress"&&(hi=!1,Mt.forEach(({body:G})=>{pe(G,1.5)}),c.add(()=>{V.to(he.shapes[0],{radius:2.81,duration:1,ease:"power2.out"})}),d.gravity.set(0,2,0),Vt=20),N==="finishProgress"){di=!0,i.hideCursor("","none"),Le.progress(1),Mt.forEach(({body:U})=>{pe(U,1.5)}),d.removeBody(Dt),d.removeBody(he),d.gravity.set(0,8,-10),Vt=-100;let G={value:-100,gravityY:8,gravityZ:-10};c.add(()=>{V.to(G,{duration:3,value:0,gravityY:0,gravityZ:0,ease:"power2.out",onUpdate:()=>{Vt=G.value,d.gravity.set(0,G.gravityY,G.gravityZ)},onComplete:()=>{Kt=!1,gs=!0,window.addEventListener("mousedown",zs,!1),Ya(),d.gravity.set(0,2,0),ri=[],Mt.forEach(({body:U,mesh:$})=>{d.removeBody(U),c.add(()=>{V.fromTo($.position,{y:$.position.y,z:$.position.z,x:$.position.x},{y:$.position.y+Math.random()*2+1,z:$.position.z+Math.random()*2+1,x:$.position.x+Math.random()*2+1,duration:15,repeat:-1,yoyo:!0,ease:"sine.inOut"})})})}})}),setTimeout(()=>{},2e3)}}),Si(()=>{window.removeEventListener("mousemove",Ss),window.removeEventListener("resize",Es),window.removeEventListener("mousedown",zs),r.destroy(),c.revert(),u.revert(),m.traverse(N=>{N instanceof dt&&(N.geometry.dispose(),N.material.dispose())}),V.ticker.remove(Ts)}),ge(()=>{Bt.value.addEventListener("ended",()=>{Bt.value.currentTime=0,Bt.value.play()},!1),Ba()});const bs=N=>{N?Bt.value.volume=0:Bt.value.volume=1,c.add(()=>{V.to(Bt.value,{volume:N?1:0,duration:.5,ease:"none"})}),N?Bt.value.play():Bt.value.pause()},Ma=N=>{i.getSoundOn&&(N?pi.value.play():pi.value.pause())},Ba=()=>{r.hide(),v=document.getElementById("home-scene"),m=new nl,y=new rl({powerPreference:"high-performance",antialias:!0,stencil:!1,depth:!0,alpha:!0});let N=window.devicePixelRatio>1?1.5:1;window.devicePixelRatio===1&&window.innerWidth>2560&&(N=.5),y.setPixelRatio(N),y.toneMapping=al,y.shadowMap.enabled=!1,y.setSize(window.innerWidth,window.innerHeight),v.appendChild(y.domElement),f=new ll(45,window.innerWidth/window.innerHeight,.1,1e3),f.setFocalLength(50),f.position.set(0,0,300);const A=new cl;A.add(f),ds=V.quickTo(A.rotation,"x",{duration:.4,ease:"power1.out"}),us=V.quickTo(A.rotation,"y",{duration:.4,ease:"power1.out"}),g=new hl(f,y.domElement),g.enableDamping=!0,g.enabled=!1,r.add(g,"enabled").name("Orbit Control"),Y={gl:y,scene:m,camera:f},Fa(),Ra(),Na(),window.addEventListener("resize",Es,!1)},Es=()=>{f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),y.setSize(window.innerWidth,window.innerHeight)},Ss=N=>{t&&window.innerWidth>1024&&(us((N.clientX/window.innerWidth*2-1)/30),ds((N.clientY/window.innerHeight*2-1)/30)),de.x=N.clientX/window.innerWidth*2-1,de.y=-(N.clientY/window.innerHeight)*2+1,i.setCursorPosition({x:N.clientX,y:N.clientY})},zs=()=>{if(Kt)return;Gt.setFromCamera(de,f);const N=Gt.intersectObjects(ci,!0);if(N.length)switch(N[0].object.parent.userData.name){case"Work_4_Empty":Ge("/cases/intel-ai-io");break;case"Work_3_Empty":Ge("/cases/3d-configurator");break;case"Work_2_Empty":Ge("/cases/the-silly-bunny");break;case"Work_1_Empty":Ge("/cases/crystal-beat");break}},Fa=async()=>{const N=await o.loadAsync("/hdri/photo_studio_01_1k.hdr");N.mapping=Ve,m.environment=N,i.setPreloaderPercentage(12)},Ra=()=>{const N=t&&window.innerWidth>1024?1:.5;new dl().load("/fonts/Druk_Regular.json",function(A){const G=new Zt({color:0,transparent:!0,opacity:1,side:He}),U=A.generateShapes("CRYSTAL AGENCY",2.2*N),$=new ul(U);$.computeBoundingBox();const W=-.5*($.boundingBox.max.x-$.boundingBox.min.x);$.translate(W,0,0);const Q=new dt($,G);Q.position.z=-5*N,Q.position.y=-1.5*N,Q.position.x=-.1*N,m.add(Q),c.add(()=>{V.to(Q.position,{y:0,x:-15,ease:"power2.inOut",scrollTrigger:{trigger:"body",start:"top top",end:"top+=900 top",scrub:!0,onLeave:()=>{Q.visible=!1},onEnterBack:()=>{Q.visible=!0}}})})}),i.setPreloaderPercentage(20)},Na=async()=>{w={customBackground:m.background,backside:!0,thickness:5,backsideThickness:1.5},B=new xi,k=new xi,T=new xi,x=new bi({anisotropy:.5,samples:t&&window.innerWidth>1024?4:2}),x.reflectivity=.04,x.color=new at(i.getJelColor).convertLinearToSRGB(),b=new Qt(256,256,{minFilter:vt,magFilter:vt,colorSpace:y.outputColorSpace,type:Jt}),R=new Qt(256,256,{minFilter:vt,magFilter:vt,colorSpace:y.outputColorSpace,type:Jt}),j=x,j.buffer=R.texture,l.open(),l.add(w,"backside"),l.add(w,"thickness",0,5,.01),l.add(w,"backsideThickness",0,5,.01),l.add(x,"reflectivity",0,1,.01),l.add(x,"roughness",0,1,.01),l.add(x,"anisotropy",0,1,.01),l.add(x,"chromaticAberration",0,1,.01),l.add(x,"distortion",0,10,.01),l.add(x,"thickness",0,5,.01),l.add(x,"temporalDistortion",0,1,.01),l.add(x,"anisotropicBlur",0,10,.01),l.addColor(x,"attenuationColor"),l.addColor(x,"color"),l.add(x,"attenuationDistance",0,2),S={customBackground:m.background,backside:!1,thickness:1.3,backsideThickness:.5},C=new bi({anisotropy:.5,roughness:.001,chromaticAberration:0,samples:t&&window.innerWidth>1024?4:2}),C.reflectivity=.25,C.chromaticAberration=.01,C.anisotropy=.16,C.anisotropicBlur=0,C.attenuationDistance=2,a.open(),a.add(S,"thickness",0,5,.01).name("Thickness 2"),a.add(C,"reflectivity",0,1,.01).name("Reflectivity 2"),a.add(C,"roughness",0,1,.01).name("Roughness 2"),a.add(C,"anisotropy",0,1,.01).name("Anisotropy 2"),a.add(C,"chromaticAberration",0,1,.01).name("Chromatic Aberration 2"),a.add(C,"distortion",0,10,.01).name("Distortion 2"),a.add(C,"thickness",0,5,.01).name("Thickness 2"),a.add(C,"temporalDistortion",0,1,.01).name("Temporal Distortion 2"),a.add(C,"anisotropicBlur",0,10,.01).name("Anisotropic Blur 2"),a.addColor(C,"attenuationColor").name("Attenuation Color 2"),a.addColor(C,"color").name("Color 2"),a.add(C,"attenuationDistance",0,2).name("Attenuation Distance 2"),a.add(C,"opacity",0,1,.01).name("opacity"),new Qt(t&&window.innerWidth>1024?1024:512,t&&window.innerWidth>1024?1024:512,{minFilter:vt,magFilter:vt,colorSpace:y.outputColorSpace,type:Jt}),M=new Qt(t&&window.innerWidth>1024?1024:512,t&&window.innerWidth>1024?1024:512,{minFilter:vt,magFilter:vt,colorSpace:y.outputColorSpace,type:Jt}),_=C,_.buffer=M.texture,P={customBackground:m.background,thickness:.08,backsideThickness:.5,backside:!1},I=new bi({anisotropy:.5,roughness:.5,chromaticAberration:0,samples:(t&&window.innerWidth>1024,2)}),I.reflectivity=.01,I.chromaticAberration=.02,I.anisotropy=.16,I.anisotropicBlur=15,I.attenuationDistance=2,I.side=He,I.temporalDistortion=.3,new Qt(256,256,{minFilter:vt,magFilter:vt,colorSpace:y.outputColorSpace,type:Jt}),F=new Qt(256,256,{minFilter:vt,magFilter:vt,colorSpace:y.outputColorSpace,type:Jt}),H=I,H.buffer=F.texture,i.setPreloaderPercentage(25),await Ia()},Ia=async()=>{const N=await s.loadAsync("/models/Scene14.glb"),A=N.scene,G=N.animations;ue=A.children[7],ai=A.children[0],qe=ue.position.clone(),hs=ai.position.clone(),g.target=hs,A.children[4].children[0].scale.set(3.4,3.4,3.4),c.add(()=>{Le=V.timeline({paused:!0}),Le.fromTo(A.children[4].children[0].scale,{x:3.4,y:3.4,z:3.4},{x:6.185419082641602,y:6.185419082641602,z:6.185419082641602,ease:"none"})}),A.children[4].children[0].children[0].material=x,z=A.children[4].children[0].children[1].material,A.children[4].children[0].children[1].material.color=new at(i.getJelColor2).convertLinearToSRGB(),ss.push(A.children[4].children[0].children[0]),r.addColor(A.children[4].children[0].children[1].material,"color").name("Jelly Color out"),r.add(A.children[4].children[0].children[1].material,"opacity",0,1).name("Jelly Opacity out"),m.add(A);const U=[];if(G.length){p=new pl(A);for(let W=0;W<G.length;W++)if(W!==2){const Q=p.clipAction(G[W]);U.push(Q),Q.reset().play().paused=!0}}li=p.clipAction(G[2]),li.reset().play().paused=!1,c.add(()=>{De.create({trigger:"body",start:"top top",end:"top+=10500 bottom",scrub:!0,invalidateOnRefresh:!0,onUpdate:W=>{U[0].time=25*W.progress,U[1].time=25*W.progress,U[2].time=25*W.progress,U[3].time=25*W.progress,U[4].time=25*W.progress,U[5].time=25*W.progress,U[6].time=25*W.progress,p.update(rt.getDelta())}}),e&&V.fromTo([ws],{value:15},{value:-15,ease:"none",yoyo:!0,duration:.7,repeat:1,scrollTrigger:{trigger:"body",start:"top+=8000 top",end:"top+=9000 top",toggleActions:"play none none reverse"}})}),u.add(()=>{Pa.fromTo(z,{},{ease:"none",scrollTrigger:{trigger:"body",start:"top top",end:"top+=1000 top",scrub:!0,onUpdate:W=>{x.color=new at(i.getJelColor).convertLinearToSRGB().lerp(new at("#baf6fc").convertLinearToSRGB(),W.progress),z.color=new at(i.getJelColor2).convertLinearToSRGB().lerp(new at("#0061ff").convertLinearToSRGB(),W.progress)}}}).fromTo(z,{},{scrollTrigger:{trigger:"body",start:"top+=2000 top",end:"top+=3000 top",scrub:!0,onUpdate:W=>{x.color=new at("#baf6fc").convertLinearToSRGB().lerp(new at("#fffc41").convertLinearToSRGB(),W.progress),z.color=new at("#0061ff").convertLinearToSRGB().lerp(new at("#fffc41").convertLinearToSRGB(),W.progress)}}}).fromTo(z,{},{scrollTrigger:{trigger:"body",start:"top+=3000 top",end:"top+=4000 top",scrub:!0,onUpdate:W=>{x.color=new at("#fffc41").convertLinearToSRGB().lerp(new at(i.getJelColor).convertLinearToSRGB(),W.progress),z.color=new at("#fffc41").convertLinearToSRGB().lerp(new at(i.getJelColor2).convertLinearToSRGB(),W.progress)}}})}),A.children[1].children.forEach((W,Q)=>{fs.push(W),setTimeout(()=>{W.visible=!1},500),!t&&window.innerWidth<1024&&W.scale.set(8e3,8e3,8e3),W.children[0].material=I.clone(),ns.push(W.children[0]),Cs(),W.children[1].material.transparent=!0,c.add(()=>{V.fromTo(W.children[1].material.map.offset,{x:0},{x:2*Math.PI*(360/360),duration:120,repeat:-1,ease:"none"})}),ci.push(W.children[0])}),A.children[1].children[3].children[1].material.side=He,A.children[5].children.forEach((W,Q)=>{if(ui.push(W),setTimeout(()=>{W.visible=!1},500),W.material=new Zt({wireframe:!1,color:0,side:He}),window.innerWidth<1025){if(Q===0){const pt=-.12*(W.geometry.boundingBox.max.x-W.geometry.boundingBox.min.x);W.geometry.translate(pt,0,0)}W.scale.set(W.scale.x*.55,W.scale.y*.55,W.scale.z*.55)}}),ht=new qt(A.children[8].position.x-.3,A.children[8].position.y,A.children[8].position.z-1).clone(),A.children[8].material=new Rs({color:12632256,roughness:.1,metalness:1});const $=i.getPreloaderDone?150:200;setTimeout(()=>{A.children[8].visible=!1,f.position.set(0,0,$)},500),ui.push(A.children[8]),A.children[6].scale.set(A.children[6].scale.x*1.2,A.children[6].scale.y*1.2,A.children[6].scale.z*1.2),V.ticker.fps(60),V.ticker.add(Ts),i.setPreloaderPercentage(90),qa()},ka=()=>{f.position.set(ue.position.x,ue.position.y,ue.position.z),g.target=ai.position,g.update()},qa=()=>{s.load("/models/half4.glb",N=>{const A=N.scene;rs=A,A.scale.set(3,3,3),A.position.x=0,A.position.y=0,A.position.z=0,A.visible=!1,as=A.clone(),m.add(A),Wa(),La(),i.setPreloaderPercentage(95)})},La=async()=>{const N=await new Ye().loadAsync("/hdri/sphere5.png"),A=await new Ye().loadAsync("/textures/paternWhiteBlackBack.jpg"),G=await new Ye().loadAsync("/textures/whiteTexture.jpg");N.mapping=Ve,N.colorSpace=Ei,A.mapping=Ve,A.colorSpace=Ei,A.wrapS=_e,A.wrapT=_e,A.repeat.set(100,100),G.mapping=Ve,G.colorSpace=Ei,G.wrapS=_e,G.wrapT=_e,G.repeat.set(100,100);const U=new ve(80,64,64),$=new Rs({map:N,side:Ns,lightMap:A,lightMapIntensity:1,envMap:G,envMapIntensity:1,transparent:!1});ke=new dt(U,$);const W=i.getPreloaderDone?.6:.3;ke.scale.set(W,W,W),m.add(ke),i.getPreloaderDone&&(je=0,i.showScene(!0)),i.setPreloaderPercentage(100),i.setPreloaderDone(!0),setTimeout(()=>{i.finishTransition()},100)},ja=()=>{j.time=rt.getElapsedTime();for(const N of ss){const A=N;j.buffer===R.texture&&(nt=Y.gl.toneMapping,ot=Y.scene.background,It=A.material.side,Y.gl.toneMapping=ml,w.background&&(Y.scene.background=w.background),A.material=B,w.backside&&(Y.gl.setRenderTarget(b),Y.gl.render(Y.scene,Y.camera),A.material=j,A.material.buffer=b.texture,A.material.thickness=w.backsideThickness,A.material.side=Ns),Y.gl.setRenderTarget(R),Y.gl.render(Y.scene,Y.camera),A.material=j,A.material.thickness=w.thickness,A.material.side=It,A.material.buffer=R.texture,Y.scene.background=ot,Y.gl.setRenderTarget(null),A.material=j,Y.gl.toneMapping=nt)}},Oa=()=>{_.time=rt.getElapsedTime();for(const N of ri){const A=N;_.buffer===M.texture&&(mt=Y.gl.toneMapping,Z=Y.scene.background,Wt=A.material.side,S.background&&(Y.scene.background=S.background),A.material=k,Y.gl.setRenderTarget(M),Y.gl.render(Y.scene,Y.camera),A.material=_,A.material.thickness=S.thickness,A.material.side=Wt,A.material.buffer=M.texture,Y.scene.background=Z,Y.gl.setRenderTarget(null),A.material=_,Y.gl.toneMapping=mt)}},Cs=()=>{H.time=rt.getElapsedTime();for(const N of ns){const A=N;H.buffer===F.texture&&(wt=Y.gl.toneMapping,D=Y.scene.background,Ie=A.material.side,P.background&&(Y.scene.background=P.background),A.material=T,Y.gl.setRenderTarget(F),Y.gl.render(Y.scene,Y.camera),A.material=H,A.material.thickness=P.thickness,A.material.side=Ie,A.material.buffer=F.texture,Y.scene.background=D,Y.gl.setRenderTarget(null),A.material=H,Y.gl.toneMapping=wt)}},Wa=()=>{d.gravity.set(0,2,0),new Ta(m,d),s.load("/models/segRoman.glb",N=>{const A=N.scene,G=as.children[0].geometry;G.computeVertexNormals();const U=G.attributes.position.array,$=G.index?G.index.array:void 0;new qt;const W=new qt,Q=new qt,pt=new qt,Ft=new qt;for(let zt=0;zt<($?$.length:U.length/3);zt+=3){for(let yt=0;yt<3;yt++){const me=$?$[zt+yt]*3:(zt+yt)*3;yt===0&&Q.fromArray(U,me),yt===1&&pt.fromArray(U,me),yt===2&&Ft.fromArray(U,me)}W.crossVectors(pt.clone().sub(Q),Ft.clone().sub(Q)).normalize();const kt=new qt().addVectors(Q,pt).add(Ft).divideScalar(1),Ps=Q.distanceTo(pt),Ms=pt.distanceTo(Ft),Bs=Ft.distanceTo(Q),Ka=Math.max(Ps,Ms,Bs)*.5,Za=Math.min(Ps,Ms,Bs)*.5,Yt=A.clone();if(Yt.children[0].material=C,zt===0&&ri.push(Yt.children[0]),Yt.scale.set(2.2,2.2,2.2),Yt.lookAt(W.add(kt)),zt%2===0){m.add(Yt);const yt=new L({mass:.8,angularDamping:.1,linearDamping:.9,sleepSpeedLimit:.1,linearFactor:new h(1,1,1),fixedRotation:!1,sleepTimeLimit:1,shape:new oe(new h(Ka*1.4,Za*2,.07))});yt.position.set(kt.x*5+(Math.random()*10-5),kt.y*5+(Math.random()*10-5),kt.z*5+(Math.random()*10-5)),d.addBody(yt),yt.attractorPoint=kt.clone(),yt.quaternionPoint=new Is().copy(Yt.quaternion),Mt.push({mesh:Yt,body:yt});const me=new qt(kt.x/2+(Math.random()*10-5),kt.y/2+(Math.random()*10-5),kt.z/2+(Math.random()*10-5));ms.push(me)}}he=new L({mass:0,position:new h(0,0,0),shape:new Fe(2.81)}),d.addBody(he),Vt=40,setTimeout(()=>{Vt=20,Mt.forEach(({body:zt})=>{pe(zt,5)})},1300),setTimeout(()=>{Mt.forEach(({body:zt})=>{pe(zt,2)})},2600)}),Da()},pe=(N,A)=>{N.mass=A,N.updateMassProperties()},Da=()=>{const N=new ve(.7,32,32),A=new Zt({visible:!1});cs=new dt(N,A),ls=new Fe(.7),Dt=new L({mass:0}),Dt.addShape(ls),d.addBody(Dt)};let Oe=!1;const Ga=()=>{if(di)return;Gt.setFromCamera(de,f);const N=Gt.intersectObject(rs,!0);if(N.length>0){Oe||(Oe=!0,i.showCursor("Click<br> and hold","none"));const A=N[0].point;Dt.position.set(A.x,A.y,A.z)}N.length===0&&Oe&&(Oe=!1,Dt.position.set(0,0,0),i.hideCursor(i.getCursorText,"none"))},Va=()=>{const N=[.95,.8,.75,.6];return N[Math.floor(Math.random()*N.length)]};let yi=!1;const Ha=()=>{Mt.forEach(({body:N},A)=>{let G;hi?G=ms[A]:G=N.attractorPoint;const U=new h;U.copy(G);const $=U.vsub(N.position);$.normalize(),$.scale(Vt,$);const W=new Is().copy(N.quaternion).slerp(N.quaternionPoint,.4);N.quaternion.copy(W),N.applyForce($)})};let ye;const Ya=async()=>{const N=new vi(20,12,1,1),A=new Zt({color:0});ye=new dt(N,A),ye.position.set(ht.x,ht.y,ht.z),ye.visible=!1,m.add(ye);const G=await s.loadAsync("/models/Sphere_footer_baked.glb");await new Ye().load("/textures/cross.jpg",U=>{for(let W=0;W<ao;W++){const Q=Va();c.add(()=>{De.create({trigger:"body",start:"top+=7000 top",end:"top+=10000 bottom",onEnter:()=>{yi=!0},onLeaveBack:()=>{yi=!1}})});const pt=G.scene.clone();pt.position.set(ht.x+(Math.random()*10-5),ht.y+(Math.random()*10-5),ht.z+(Math.random()*10-5)),pt.rotation.set(1,0,0),pt.scale.set(Q*12.5,Q*12.5,Q*12.5),m.add(pt);const Ft=new L({mass:.5,angularDamping:.1,linearDamping:.65,fixedRotation:!1,shape:new Fe(Q)});Ft.position.set(ht.x+(Math.random()*10-5),ht.y+(Math.random()*10-5),ht.z+(Math.random()*10-5)),d.addBody(Ft),ps.push({mesh:pt,body:Ft})}const $=new L({mass:0,angularDamping:.1,linearDamping:.65,fixedRotation:!0,shape:new oe(new h(2.6,.4,.2))});$.position.set(ht.x,ht.y,ht.z+1),d.addBody($),_a(),ys=!0})};let As,We;const _a=()=>{const N=new ve(2.2,32,32),A=new Zt({visible:!1});new dt(N,A),As=new Fe(2.2),We=new L({mass:0}),We.addShape(As),d.addBody(We)};let Ht,mi;const Xa=()=>{Gt.setFromCamera(de,f);const N=Gt.intersectObject(ye,!0);if(N.length>0){const G=N[0].point;We.position.set(G.x,G.y,G.z)}const A=Gt.intersectObjects(ci,!0);if(A.length>0&&!Ht){if(e)return;Ht=A[0].object.parent,i.showCursor("View<br> Case"),Ht=A[0].object.parent,mi=A[0].object,c.add(()=>{V.to(Ht.scale,{x:12e3,y:12e3,z:12e3,duration:.5,ease:"power2.out"}),V.to(mi.material,{distortion:15,duration:.5,ease:"power2.out"})})}Ht&&A.length===0&&(i.hideCursor(""),c.add(()=>{V.to(Ht.scale,{x:1e4,y:1e4,z:1e4,duration:.5,ease:"power2.out"}),V.to(mi.material,{distortion:0,duration:.5,ease:"power2.out"})}),Ht=null)},Ua=()=>{Xa(),!(Kt||!yi)&&(d.step(1/60),ps.forEach(({mesh:N,body:A})=>{const G=new h;G.copy(ht);const U=G.vsub(A.position);U.normalize(),U.scale(ws.value,U),A.applyForce(U),N.position.copy(A.position),N.quaternion.copy(A.quaternion)}))},$a=()=>{Ha(),Dt&&cs&&Ga(),d.step(1/60),Mt.forEach(({mesh:N,body:A},G)=>{N.position.copy(A.position),N.quaternion.copy(A.quaternion)})},Ts=()=>{const N=rt.getDelta();vs&&ka(),Kt&&$a(),ys&&!Kt&&Ua(),p._actions&&p.update(N),ja(),gs?Cs():Oa(),g.update(),y.render(m,f)};return(N,A)=>(_t(),zi(ks,{to:"body"},[O("div",{ref_key:"mainScene",ref:xs,id:"home-scene"},null,512),O("audio",{ref_key:"audioGlass",ref:pi,src:"/audio/Sphere-collision.mp3"},null,512),O("audio",{ref_key:"audioBg",ref:Bt,src:"/audio/BG5.mp3"},null,512)]))}},co=lo,ho={class:"click-and-hold"},uo={class:"wrapper"},po=O("p",{class:"text"},[O("span",null,"Are you ready to step into the future?"),Lt(),O("span",null,"Click and hold"),O("span",null,"Tap and hold")],-1),yo={class:"progress"},mo={__name:"clickAndHold",setup(E){const t=fe(),e=et(null),i=et(null),o=et(null),s=et(!1);let n,r=V.context(()=>{n=V.timeline({paused:!0})});t.$onAction(({name:d})=>{d==="setSceneStartingPosition"&&(a(),l()),d==="finishProgress"&&(s.value=!0),d==="holdGlass"&&c(),d==="stopGlass"&&u()}),ge(()=>{}),Si(()=>{});const l=()=>{r.add(()=>{V.to(i.value,{duration:.5,opacity:1})})},a=()=>{n.fromTo(e.value,{width:"0%"},{width:"100%",duration:2,ease:"none",onUpdate:function(){t.updateProgress(this.progress())},onComplete:()=>{t.getSoundOn&&o.value.play(),t.finishProgress(),V.to(".click-and-hold",{duration:.5,opacity:0,onComplete:()=>{V.set(".click-and-hold",{display:"none"})}})}})},c=()=>{s.value||(t.startProgress(),n.play())},u=()=>{s.value||(t.stopProgress(),n.pause(),n.reverse())};return(d,p)=>(_t(),Ue("div",{ref_key:"parent",ref:i,class:"parent-click-hold"},[O("div",ho,[O("div",uo,[po,O("div",yo,[O("div",{ref_key:"progress",ref:e,class:"progress-bar"},null,512)])])]),O("audio",{ref_key:"audio",ref:o,src:"/audio/ParticleScattering.mp3"},null,512)],512))}},vo=mo,fo=Xe("/images/icons/textLightning.svg"),go=Xe("/images/icons/textFace.svg"),wo=Xe("/images/icons/textPlus.svg"),ni=Xe("/images/icons/rightBar.svg"),xo={class:"wrapper"},bo={class:"bottom-texts"},Eo=O("img",{alt:"icon",src:fo},null,-1),So=O("img",{alt:"icon",src:go},null,-1),zo=O("img",{alt:"icon",src:wo},null,-1),Co=O("p",null," Each project at Crystal Agency serves as a testament to our commitment to innovation and excellence ",-1),Ao=[Co],To=O("p",null," Browse our portfolio to see the magic we create with cutting-edge technologies including XR, AR, AI and 3D. ",-1),Po=[To],Mo=qs('<div class="left-bar"><div class="parent"><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="value">AR</div><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="value">3D</div><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="value">AI</div><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="value">XR</div><div class="cross"></div><div class="cross"></div><div class="cross"></div><div class="cross"></div></div></div>',1),Bo={class:"right-bar"},Fo={class:"parent"},Ro=O("img",{alt:"icon",src:ni},null,-1),No={class:"progress"},Io=O("img",{alt:"icon",src:ni},null,-1),ko={__name:"sceneTextsComponent",setup(E){V.registerPlugin(De);const t=fe(),e=et(null),i=et(null),o=et(null),s=et(null),n=et(null),r=et(null);let l,a,c;t.$onAction(({name:d})=>{d==="finishProgress"&&V.to(e.value,{duration:.5,delay:.3,opacity:1})}),ge(()=>{l=V.context(()=>{}),u()});const u=()=>{l.add(()=>{a=V.timeline({}),a.fromTo(i.value,{opacity:1},{opacity:0,scrollTrigger:{trigger:"body",start:"top top",end:"top+=500 top",scrub:!0}}).fromTo(o.value,{opacity:0},{opacity:1,scrollTrigger:{trigger:"body",start:"top+=500 top",end:"top+=1000 top",scrub:!0}}).fromTo(o.value,{opacity:1},{opacity:0,scrollTrigger:{trigger:"body",start:"top+=3700 top",end:"top+=4100 top",scrub:!0}}).fromTo(s.value,{opacity:0},{opacity:1,scrollTrigger:{trigger:"body",start:window.innerWidth>1024?"top+=8000 top":"top+=8500 top",end:window.innerWidth>1024?"top+=8500 top":"top+=9000 top",scrub:!0}}).fromTo(o.value,{opacity:0},{opacity:0}).fromTo(s.value,{opacity:0},{opacity:0}),c=V.timeline(),c.fromTo(n.value,{opacity:0},{opacity:1,scrollTrigger:{trigger:"body",start:"top+=4500 top",end:"top+=4900 top",scrub:!0}}).fromTo(n.value,{opacity:1},{opacity:0,scrollTrigger:{trigger:"body",start:"top+=4900 top",end:"top+=5400 top",scrub:!0}}).fromTo(r.value,{opacity:0},{opacity:1,scrollTrigger:{trigger:"body",start:"top+=5300 top",end:"top+=5700 top",scrub:!0}}).fromTo(r.value,{opacity:1},{opacity:0,scrollTrigger:{trigger:"body",start:"top+=5700 top",end:"top+=6100 top",scrub:!0}}).fromTo([r.value,n.value],{opacity:0},{opacity:0})})};return(d,p)=>(_t(),Ue("div",{ref_key:"texts",ref:e,class:"scene-texts"},[O("div",xo,[O("div",bo,[O("p",{ref_key:"bottom1",ref:i,class:"bottom-text-1 bottom-text"},[Eo,Lt(" Welcome to a Creative space showcasing groundbreaking projects that blend creativity and technology ")],512),O("p",{ref_key:"bottom2",ref:o,class:"bottom-text-2 bottom-text"},[So,Lt(" Follow us into the future of interactive and immersive digital experiences ")],512),O("p",{ref_key:"bottom3",ref:s,class:"bottom-text-3 bottom-text"},[zo,Lt(" Engage with us at Crystal Agency, where technology meets creativity, and every interaction is an opportunity for innovation ")],512)]),O("div",{ref_key:"leftText",ref:n,class:"left-text"},Ao,512),O("div",{ref_key:"rightText",ref:r,class:"right-text"},Po,512)]),Mo,O("div",Bo,[O("div",Fo,[Ro,O("p",No,Ci(Math.round(J(t).getScrollProgress*100))+"%",1),Io])])],512))}},qo=ko,Lo=O("div",{class:"top"},null,-1),jo={class:"center"},Oo=O("p",null,"Immerse",-1),Wo=[Oo],Do=qs('<span class="elem-1 elem">[</span><span class="elem-2 elem">]</span><span class="elem-3 elem">[</span><span class="elem-4 elem">]</span><div class="circle"><div class="inner-circle"><p>start</p></div></div>',5),Go=[Do],Vo=O("p",null,[Lt(" me in "),O("img",{alt:"arrow",class:"arrow",src:gl})],-1),Ho=[Vo],Yo=O("p",null,"Loading",-1),_o=[Yo],Xo={class:"bar"},Uo={class:"space"},$o=O("span",null,"%",-1),Ko={class:"bottom"},Zo={class:"lines"},Qo={class:"status"},Jo=O("div",{class:"back-left"},null,-1),ts=O("div",{class:"back-right"},null,-1),es=O("p",null,[Lt(" T\u043E make this experience more"),O("br"),Lt(" immersive we use sound effects ")],-1),is={__name:"homePreloader",setup(E){const t=fe();let e=V.context(()=>{});const{isMobile:i}=wi(),o=et(null),s=et(null),n=et(null),r=et(null),l=et(null),a=et(null),c=et(null),u=et(null);t.$onAction(({name:m})=>{m==="setPreloaderDone"&&d(),m==="setSceneStartingPosition"&&e.add(()=>{V.to(a.value,{display:"none",pointerEvents:"none"})})}),Si(()=>{e.revert()}),ge(()=>{e.add(()=>{V.to(a.value,{opacity:1,pointerEvents:"auto",duration:.5,ease:"power2.inOut"})})});const d=()=>{e.add(()=>{i?(V.to(o.value,{width:i?"100%":0,ease:"power2.inOut",duration:1.2,delay:.4}),V.to([o.value,s.value,n.value],{opacity:0,ease:"power2.inOut",duration:.5,delay:.8}),V.to(l.value,{opacity:1,pointerEvents:"auto",ease:"power2.inOut",duration:.5,delay:1.2}),V.to(r.value,{transform:"scale(1)",width:i?110:184,ease:"power2.inOut",duration:.5,delay:1.8})):(V.to(o.value,{width:i?"100%":0,ease:"power2.inOut",duration:1.2,delay:.4}),V.to([n.value,s.value],{width:0,ease:"power2.out",duration:.6,delay:1.1}),V.to([c.value,u.value],{clipPath:"inset(0% 0% 0% 0%)",ease:"power2.out",duration:.6,delay:1.8}),V.to(l.value,{pointerEvents:"auto",ease:"power2.inOut",duration:.1,delay:2.5}),V.to(r.value,{transform:"scale(1)",width:i?110:184,ease:"power2.inOut",duration:.5,delay:2.4}))})},p=()=>{t.showScene(!0),t.hideCursor(t.getCursorText,"none"),e.add(()=>{V.to(a.value,{opacity:0,pointerEvents:"none",duration:.7,ease:"power2.inOut"})})};return(m,y)=>(_t(),Ue("div",{ref_key:"preloader",ref:a,class:"home-preloader"},[Lo,O("div",jo,[O("div",{ref_key:"done",ref:l,class:"done"},[O("div",{ref_key:"text1",ref:c,class:"text text-1"},Wo,512),O("div",{onClick:p,ref_key:"send",ref:r,class:"send"},[O("div",{onMouseleave:y[0]||(y[0]=v=>J(t).hideCursor(J(t).getCursorText,"none")),onMouseenter:y[1]||(y[1]=v=>J(t).blendCursor("difference")),class:"child"},Go,32)],512),O("div",{ref_key:"text2",ref:u,class:"text text-2"},Ho,512)],512),O("div",{ref_key:"loading",ref:n,class:"loading"},_o,512),O("div",{ref_key:"progress",ref:o,class:"progress"},[O("div",Xo,[O("div",Uo,[O("div",{style:zl({left:J(t).getPreloaderPercentage+"%"}),class:"fill"},null,4)])])],512),O("div",{ref_key:"value",ref:s,class:"value"},[O("p",null,[Lt(Ci(J(t).getPreloaderPercentage),1),$o])],512)]),O("div",Ko,[O("div",null,[O("div",{class:"volume",onMouseleave:y[2]||(y[2]=v=>J(t).hideCursor(J(t).getCursorText,"none")),onMouseenter:y[3]||(y[3]=v=>J(t).blendCursor("difference")),onClick:y[4]||(y[4]=v=>J(t).toggleSound(!J(t).getSoundOn))},[O("div",Zo,[O("img",{class:Ls([{active:J(t).getSoundOn},"off"]),alt:"lines",src:vl},null,2),O("img",{class:Ls([{active:J(t).getSoundOn},"on"]),alt:"lines",src:fl},null,2)]),O("div",Qo,[O("p",null,Ci(J(t).getSoundOn?"on":"off"),1)]),Jo,ts],32)]),es])],512))}},os=is,Os={__name:"index",setup(E){const t=fe();return wi(),ge(()=>{t.disableScroll()}),wl((e,i,o)=>{t.startTransition(e.path,i.path,o)}),(e,i)=>{const o=xl;return _t(),Ue("div",null,[O("div",{onMousedown:i[0]||(i[0]=(...s)=>J(t).holdGlass&&J(t).holdGlass(...s)),onMouseup:i[1]||(i[1]=(...s)=>J(t).stopGlass&&J(t).stopGlass(...s)),onTouchstart:i[2]||(i[2]=(...s)=>J(t).holdGlass&&J(t).holdGlass(...s)),onTouchend:i[3]||(i[3]=(...s)=>J(t).stopGlass&&J(t).stopGlass(...s)),class:"home-page"},[Xt(o,null,{default:js(()=>[Xt(co)]),_:1}),(_t(),zi(ks,{to:"body"},[Xt(o,null,{default:js(()=>[Xt(vo)]),_:1}),Xt(qo),Xt(bl),J(t).getPositionSceneStart?Cl("",!0):(_t(),zi(os,{key:0}))]))],32),Xt(Al)])}}}});export{Ml as __tla,Os as default};
